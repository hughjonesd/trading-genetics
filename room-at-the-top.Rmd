---
title: 'Room at the top: biological lock-in of social advantage'
author: David Hugh-Jones & Abdel Abdellaoui
date: "`r Sys.Date()`"
output: 
  bookdown::pdf_document2:
    toc: false
    latex_engine: xelatex
editor_options: 
  chunk_output_type: console
header-includes:
  - \usepackage{subfig}
  - \usepackage{amsmath}
  - \usepackage{amsthm}
  - \usepackage{setspace}
  - \usepackage{placeins}
  - \newtheorem{prop}{\protect\propositionname}
  - \providecommand{\propositionname}{Proposition}
---

```{r setup, include = FALSE}
library(drake)
library(dplyr)
library(magrittr)
library(AER)
library(ggplot2)
library(Hmisc)
library(huxtable)
library(broom)
library(fixest)
library(santoku)

knitr::opts_chunk$set(echo = FALSE)

drake::loadd(mf_pairs)
drake::loadd(mf_pairs_twice)
drake::loadd(famhist)
drake::loadd(resid_scores)

famhist %<>% left_join(resid_scores, by = "f.eid")
rm(resid_scores)

famhist$EA3 <- famhist$EA3_excl_23andMe_UK_resid


theme_set(theme_minimal())
```

# Introduction

Charles Murray (1995) warned of "a merging of the cognitive elite with the
affluent". On the opposite side of the political spectrum, Karl Marx (1844)
wrote "I am ugly, but I can buy the most beautiful woman.... the effect of
ugliness, its repelling power, is destroyed by money." These quotations suggest
that social advantages, such as wealth, caste or status, may be transformed into
biological advantages in the next generation, via assortative mating between
socially and genetically advantaged people. We call this process 
*biological lock-in*.

Figures \@ref(fig:pic-basic-corr-uni) and \@ref(fig:pic-basic-corr-income) 
illustrate the idea using data for spouse
pairs from UK Biobank. Figures \@ref(fig:pic-basic-corr-uni) plots one partner's 
mean polygenic score for educational attainment (PSEA) against a measure of the 
other partner's actual educational
attainment: possession of a university degree. University graduates had spouses
with higher PSEA.^[To minimize concerns about genetic stratification, i.e.
correlations between genetics and non-genetic forms of inherited advantage, PSEA
is residualized by the first 100 principal components of UK Biobank array data.]
Figure \@ref(fig:pic-basic-corr-income) plots one partner's PSEA against another
measure of social status: income. 

These figures do not prove that biological lock-in is taking place: since an
individual's own PSEA correlates with both their educational attainment, and
their income, both figures could be a result of partner selection on a purely
genetic basis. In this paper, we test the theory more rigorously, using
environmental shocks to social status that are unlikely to be correlated with
own genetics. First, we develop a simple theory of biological lock-in, to
illustrate how its effects vary with social structure.


```{r pic-basic-corr-uni, fig.subcap = c("Female PSEA by male educational attainment", "Male PSEA by female educational attainment"), fig.cap = "Social and genetic advantage among spouse pairs in UK Biobank", fig.width = 3, fig.height = 3}

pic_ss <- stat_summary(fun.data = mean_cl_normal, na.rm = TRUE)
pic_cc <- coord_cartesian(ylim = c(-0.05, 0.2))

mf_pairs %>% 
      filter(! is.na(university.m)) %>% 
      ggplot(aes(university.m, EA3.f)) + 
        pic_ss + pic_cc +
        labs(x = "Male university attendance", y = "Female PSEA")

mf_pairs %>% 
      filter(! is.na(university.f)) %>% 
      ggplot(aes(university.f, EA3.m)) + 
        pic_ss + pic_cc +
        labs(x = "Female university attendance", y = "Male PSEA")
        
```


```{r pic-basic-corr-income, fig.subcap = c("Female EA3 by male income", "Male EA3 by female income"), fig.cap = "Social and genetic advantage among spouse pairs in UK Biobank", fig.width = 3, fig.height = 3}

pic_ss <- stat_summary(fun.data = mean_cl_normal, na.rm = TRUE)
pic_cc <- coord_cartesian(ylim = c(-0.15, 0.25))

mf_pairs %>% 
      filter(! is.na(income_cat.m)) %>% 
      ggplot(aes(income_cat.m, EA3.f)) + 
        pic_ss + pic_cc + 
        labs(x = "Male income category", y = "Female PSEA")

mf_pairs %>% 
      filter(! is.na(income_cat.f)) %>% 
      ggplot(aes(income_cat.f, EA3.m)) + 
        pic_ss + pic_cc +
        labs(x = "Female income category", y = "Male PSEA")
        
```


# Theory

The population is size 1. There is a single binary genetic trait and a single
social trait. Individuals $i$ thus have $G_{i}\in\{0,1\}$ and $S_{i}\in\{0,1\}$;
write $\tau_{i}=(G_{i},S_{i})$ to fully describe $i$'s type. We will call
individuals with $\tau_{i}=(1,1)$, $(1,0)$, $(0,1)$ and $(0,0)$, b-types,
g-types, s-types and n-types respectively. The proportion of the population with
$G_{i}=1$ is denoted by $\gamma$, and the population proportion with $S_{i}=1$
is denoted by $\sigma$. In generation 1, $G_i$ and $S_i$ are assumed independent,
so e.g. the proportion of b-types is $\gamma\sigma$.

Higher values of $G_i$ and $S_i$ are assumed to be attractive in the
marriage market. Indeed, individuals are divided into two classes, $H$ and $L$,
for the purpose of marital matching. Within $H$ and $L$, all individuals form
spouse pairs at random. Class $H$ is of size $\theta$: we assume 
$\gamma\sigma < \theta \le \min\{\gamma,\sigma\}$. We also assume 
$\gamma$ and $\sigma$ are not too different:

\begin{equation}
\textrm{Either }\sigma < \gamma < (1+\sigma)/2
\textrm{ or }
\gamma < \sigma < (1+\gamma)/2.
\label{eq:sigma-gamma-close}
\end{equation}

Married pairs have two children and each randomly inherits one parent's
genetic trait and one parent's social trait. As a result, $\sigma$
and $\gamma$ stay constant over generations.

B-types with $\tau_{i} = (1,1)$ are always in $H$. N-types with $\tau_{i} = (0,0)$
are always in $L$. Where the other groups fit depends on the nature
of the society. Of the $\theta - \gamma\sigma$ non-b-types
in $H$, a proportion $k$ are s-types and the remaining $1 - k$ are
g-types. 

The value of $k$ gives the level of social stratification in the
society's marriage market. When $k$ is close to 1, individuals' place in the
marriage market is largely determined by social status, and genetics alone rarely
gives access to the high matching group. When $k$ is close to 0, "good genes"
play a larger role in the marriage market, and social status alone rarely gives access 
to the high group.

To build intuition, we start with two extreme examples. Suppose first
that $k=1$ and that $\theta = \sigma$. This is a \emph{caste society}
where marital matching is entirely driven by social status. All individuals
in $H$ ($L$) have $S_{i} = 1$ ($S_{i} = 0$), and so do their children.
On the other hand, the proportion of individuals with $G_{i} = 1$ stays
at $\gamma$ within both groups. Thus, over generations, the distributions
of $G_{i}$ and $S_{i}$ remain independent in the population.

Suppose next that $k = 0$ and $\theta = \gamma$. This society is \emph{socially
egalitarian}: only genetics matter for marital matching. All individuals
in $H$ ($L)$ have $G_{i} = 1$ ($G_{i} = 0$), and so do their children.
The proportion of individuals with $S_{i} = 1$ stays at $\sigma$ within
both groups; hence, again, $G_{i}$ and $S_{i}$ remain independent
over generations.

In between these cases, $G_{i}$ and $S_{i}$ will become positively
correlated. We examine the correlation in the second generation.

\begin{prop}
The second-generation correlation between $G_{i}$ and $S_{i}$
is concave in $k$. If $\theta$ is close enough to $\min\{\sigma,\gamma\}$,
then the correlation has a maximum at $k\in(0,1)$.
\label{prop:second-gen-cor}
\end{prop}

The logic behind Proposition \ref{prop:second-gen-cor} is simple. As we have
seen, when spouse matching is entirely on the basis of social status, or entirely on the
basis of genetics, no correlation arises between the two. However, when spouses
are selected on the basis of both genetics and social status, then some s-types,
who only have high social status, marry some g-types, who only have valuable
genetic capital. As a result, some of their children inherit both (or neither),
and this increases the correlation between genetics and social status.

Figure \@ref(fig:pic-theory) plots the second generation correlation coefficient
of $S_i$ and $G_i$ against $k$, for $\gamma = \sigma = \theta = 0.5$.

```{r pic-theory, fig.cap = "Social stratification and biological lock-in: theory", fig.width = 4, fig.height = 3.5}
rho <- function (g, s, theta, k) {
  phi <- theta - g * s
  
  rhoval <- 1/2 * phi^2 * k * (1-k) / theta +
            1/2 * (g*(1 - s) - phi*(1 - k)) * ((1 - g)*s - phi*k) / (1 - theta)
  
  rhoval
}

g <- 0.5
s <- 0.5
theta <- 0.5
op <- par(mar = c(4, 4, 1, 1), mgp = c(2, 1, 0))
curve(rho(g, s, theta, k)/sqrt(s*(1-s)*g*(1-g)), xname = "k", ylab = expression(Corr(G[i],S[i])), lwd = 2, 
      las = 1, xaxp = c(0, 1, 1), yaxp = c(0, 0.1, 1))
par(mar = op)
```


Some points are in order. First, the "marriage market" here is a reduced form
mechanism, encompassing that makes a difference to partner choice. For example,
if earned income affects attractiveness in the marriage market, then society's
level of meritocracy in the labour market will correlate with the value of $k$:
a more meritocratic labour market will allow people with low social status but
high human capital (partly genetically determined) to earn more, and therefore
to enter the high group.

Second, the contents of $G$ -- what counts as "good genes" in the marriage
market -- are themselves likely to vary across societies. For instance,
standards of physical attractiveness vary historically. Similarly, it is
plausible that what counted as a "good match", in terms of personality, physical
and intellectual characteristics, differed between medieval European nobility
and contemporary society. 

The model predicts variation in the strength of biological lock-in. In
particular, in "caste societies" where there is complete endogamy within 
social status groups, there is no scope for biological lock-in, because
marriage partners do not trade off genetics for social status. The model also 
assumes that social status is inherited randomly from one parent, in 
the same way a genetic allele is inherited. This assumption can be weakened. 
For example, if social status is inherited deterministically from the father, then the
results remain unchanged (for each pair of parents, just assume that one randomly
chosen parent is the father). 

Another possibility is that cultural rules may assign
status more or less strictly. Suppose that if both parents have $S_i = 1$, then
the children always inherit $S_i = 1$. However, if only one parent has
$S_i = 1$, then children inherit $S_i = 1$ with probability $\alpha$. A higher
value of $\alpha$ corresponds to a more "expansive" inheritance rule for social
status. For example, while British noble titles descend only to the first born
son, on Europe the status of nobility was granted to all children, creating a 
separate caste. (TODO: check details!) The original model corresponds to
$\alpha = \frac{1}{2}$.^[If $\alpha \ne \frac{1}{2}$, the size of the
high-status group increases or decreases over time. Population shares could be 
stabilized by adding noise to the inheritance process, however.] 

\begin{prop}
The second-generation correlation between $G_{i}$ and $S_{i}$
decreases in $\alpha$. 
\label{prop:cor-alpha}
\end{prop}



TODO: Points about the theory.

- Differences with meritocracy. Meritocracy models of this phenomenon have that G
  causes S. Here G may not play any causal role in determining status.
- A more complex model with continuous S and G would still have the same results
  (maybe discuss in appendix)?



# Data

As mentioned above, simple correlations between one partner's social status
and the other partner's genetics do not prove that biological lock-in is
taking place, because one's social status correlates with one's own genetics.
To demonstrate biological lock-in, we therefore need a source of social
advantage which is exogenous to genetics. One possibility is *birth order*.
It is well known that earlier-born children receive more parental care and
have better life outcomes. (XXX is it? Go check.) On the other hand, early-
and late-born full siblings have the same *ex ante* expected genetic endowment.
^[This might not be the case, if parents' choice of whether to
have more children is endogenous to the genetic endowment of their earlier 
children. We will check for this below.] We can therefore use birth order
as an exogenous shock to social status.

We use data from UK Biobank, a study of about 500,000 individuals. 

* TODO: describe N for birth order, describe PSEA calculation.
* TODO: look at mechanisms by which birth order might affect university
* TODO: get IQ data, control for it
* TODO: subset to spouses with children
* TODO: overall index of social status?


# Results 

Ideally we would instrument social status with birth order. However, our measures of
social status are noisy and incomplete. For example, we know whether subjects went
to university, but not which university they went to, and we only have rough
categorical data on household income. Birth order likely affects both these and 
other measures of social advantage. So, an instrumental variables approach
would probably fall foul of the exclusion restriction. 

Instead, we conduct a mediation analysis, following the strategy of Heckman and
Pinto (2013). We first regress our measures of own social status (i.e. income
and education) on birth order. Then, we regress spouse's PSEA on birth order,
with and without controlling for social status. Under the assumption that birth
order is exogenous to own genetics, these regressions identify the effect of
birth order, plus other environmental variables that correlate with it, on own
social status and spouse's genetics. Also, if the estimated effect of birth
order on spouse's PSEA changes when social status is included, that is evidence
that social status mediates the effect of birth order.

* TODO: clarify the empirical model, you may need help....
* TODO: reduced form
* TODO: estimate individual income from job SIC codes? ASHE gives data


```{r pic-bo-uni}
famhist %>% 
      filter(n_sibs <= 4, n_sibs >= 2, ! is.na(n_older_sibs)) %>% 
      mutate(
        `Birth order` = n_older_sibs + 1,
        `Family size` = n_sibs
      ) %>% 
      group_by(`Birth order`, `Family size`) %>% 
      dplyr::summarize(University = mean(university, na.rm = TRUE)) %>% 
      ggplot(aes(`Birth order`, University)) + 
      geom_col() +
      facet_grid(cols = vars(`Family size`), labeller = label_both) + 
      ylim(0, 0.15) 

```


```{r pic-bo-income}
famhist %>% 
      filter(
        n_sibs <= 4, 
        n_sibs >= 2, 
        ! is.na(n_older_sibs), 
        ! is.na(income_cat)
      ) %>% 
      mutate(
        `Birth order` = n_older_sibs + 1,
        `Family size` = n_sibs,
        `Income category` = factor(income_cat)
      ) %>% 
      ggplot(aes(`Birth order`, fill = `Income category`)) + 
      geom_bar(position = "fill") +
      facet_grid(cols = vars(`Family size`), labeller = label_both) + 
      scale_fill_brewer(palette = 2) + 
      labs(y = "Proportion")
```



Figures \@ref(fig:pic-bo-university) and \@ref(fig:pic-bo-income) show the
relationship between birth order, university education and income. 


## Regressions

We run regressions instrumenting one spouse's educational attainment with their
birth order. We control for overall family (i.e. sibling group)
size. Without this, then birth order would correlate with family size,
which itself may correlate with genetics, since parents of different family sizes
might have different genetic endowments. Indeed, respondents with more siblings
overall have substantially lower PSEA. We also control for subject's own PSEA. Lastly,
we allow the effect of birth order to vary depending on total family size.

Table \@ref(tab:tbl-instruments) shows instrumental variables regressions
using 2 stage least squares. We use only subjects with between 2 and 8 siblings. 
Column 1 pools men and women. Columns 2 and 3 run separate regressions by sex.
The effect is positive for both male and female subjects, but twice as strong, 
and significant, for males. 


```{r tbl-instruments}

mod_ea3_iv <- AER::ivreg(
                 EA3.y ~ university.x + factor(n_sibs.x) + EA3.x | 
                 n_older_sibs.x:factor(n_sibs.x) + factor(n_sibs.x) + EA3.x, 
                 data = mf_pairs_twice, 
                 subset = n_sibs.x >= 2 & n_sibs.x <= 8
               )

mod_ea3f_iv <- AER::ivreg(
                 EA3.f ~ university.m + factor(n_sibs.m) + EA3.m | 
                 n_older_sibs.m:factor(n_sibs.m) +factor(n_sibs.m) + EA3.m, 
                 data = mf_pairs, 
                 subset = n_sibs.m >= 2 & n_sibs.m <= 8
               )


mod_ea3m_iv <- AER::ivreg(
                 EA3.m ~ university.f + factor(n_sibs.f) + EA3.f | 
                 n_older_sibs.f:factor(n_sibs.f) + factor(n_sibs.f)  + EA3.f, 
                 data = mf_pairs, 
                 subset = n_sibs.f >= 2 & n_sibs.f <= 8
               )

# TODO: work out how to use coeftest and clustered vcov with ivreg
# 
mod_ea3_iv_or <- huxtable::tidy_override(mod_ea3_iv, extend = TRUE,
                 glance = as.list(glance(mod_ea3_iv, 
                 diagnostics = TRUE)))
mod_ea3f_iv_or <- huxtable::tidy_override(mod_ea3f_iv, extend = TRUE,
                 glance = as.list(glance(mod_ea3f_iv, 
                 diagnostics = TRUE)))
mod_ea3m_iv_or <- huxtable::tidy_override(mod_ea3m_iv,  extend = TRUE,
                 glance = as.list(glance(mod_ea3m_iv, 
                 diagnostics = TRUE)))
                                 
huxreg(
        "All spouses' EA3"    = mod_ea3_iv_or,
        "Female spouses' EA3" = mod_ea3f_iv_or, 
        "Male spouses' EA3"   = mod_ea3m_iv_or,
        coefs = c(
          "University" = "university.mTRUE", 
          "University" = "university.fTRUE",
          "University" = "university.xTRUE",
          "EA3"        = "EA3.m",
          "EA3"        = "EA3.f",
          "EA3"        = "EA3.x"
        ),
        statistics = c(
          "R2"              = "r.squared", 
          "N"               = "nobs",
          "Sargan test (p)" = "p.value.Sargan"
        ),
        note = "{stars}. Educational attainment instrumented by birth order."
      ) %>% 
      insert_row(c("Family size dummies", "Y", "Y", "Y"), after = 5) %>% 
      set_caption("Effects of educational attainment on spouse's EA3") %>% 
      set_latex_float("ht")
```


```{r}
mod_ea3_check <- lm(EA3 ~ 0 + factor(n_sibs) + n_older_sibs:factor(n_sibs), 
                    famhist, n_sibs >= 2 & n_sibs <= 8)
av <- tidy(car::Anova(mod_ea3_check)) 
av_pval <- av %>% 
              filter(term == "factor(n_sibs):n_older_sibs") %>% 
              pull(p.value)
stopifnot(av_pval > 0.05) # claim in text would be false
```


Although all children of the same parents have identical expected values of
polygenic scores, it is conceivable that parents might select family size
on the basis of genetics. For example, if the first child had a phenotype
reflecting a high (or low) polygenic score, then that might
affect the parents' decision to have a second child. To check this we 
regress birth order directly on PSEA. As before, we control for family size
and allow the effect of birth order to vary depending on family size.
Birth order variables are not jointly significant (anova p 
`r round(av_pval, 3)`) and their effect sizes are of the order of 0.01 of a 
standard deviation of PSEA.


\FloatBarrier

# Appendix

## Proof of Proposition \@ref(prop:second-gen-cor)

Write $b_{t}, g_{t}, s_{t} ,n_{t}$ for the population
proportion of each type in generation $t = 1, 2, ...$. Sometimes we drop the
subscript. Since $G_{i}$ and $S_{i}$ are independent in generation 1,

\begin{align*}
b_{1} & = \gamma\sigma; \\
g_{1} & = \gamma(1-\sigma); \\
s_{1} & = (1-\gamma)\sigma; \\
n_{1} & = (1-\gamma)(1-\sigma).
\end{align*}

Within either group $J\in\{H,L\}$, write the proportion of types
in generation $t$ as $b_{J},g_{J},s_{J},n_{J}$ for the respective
types. 

Dividing children up by their parents' types, we can calculate the
proportion with each of the four types:
\begin{center}
\begin{table}[h!]
\begin{centering}
\begin{tabular}{ccccc}

 & $b_{J}$ & $g_{J}$ & $s_{J}$ & $n_{J}$\tabularnewline
\hline 
$b_{J}$ & $1;0;0;0$ & $\frac{1}{2};\frac{1}{2};0;0$ & $\frac{1}{2};0;\frac{1}{2};0$ & $\frac{1}{4};\frac{1}{4};\frac{1}{4};\frac{1}{4}$\tabularnewline

$g_{J}$ & $\frac{1}{2};\frac{1}{2};0;0$ & $0;1;0;0$ & $\frac{1}{4};\frac{1}{4};\frac{1}{4};\frac{1}{4}$ & $0;\frac{1}{2};0;\frac{1}{2}$\tabularnewline

$s_{J}$ & $\frac{1}{2};0;\frac{1}{2};0$ & $\frac{1}{4};\frac{1}{4};\frac{1}{4};\frac{1}{4}$ & $0;0;1;0$ & $0;0;\frac{1}{2};\frac{1}{2}$\tabularnewline

$n_{J}$ & $\frac{1}{4};\frac{1}{4};\frac{1}{4};\frac{1}{4}$ & $0;\frac{1}{2};0;\frac{1}{2}$ & $0;0;\frac{1}{2};\frac{1}{2}$ & $0;0;0;1$\tabularnewline
\hline 
\end{tabular}
\par\end{centering}
\caption{Proportions of children born from different types of parents (b-type;
g-type; s-type; n-type)}
\label{tab:child-shares}
\end{table}
\par\end{center}

Summing these in each group, and using that $n_H = 0$ and $b_L = 0$,
gives the proportion of children of each type in each group:

\begin{align*}
b_{J, t+1} & = b_{J} + \frac{1}{2} \rho_{J} \\
g_{J, t+1} & = g_{J} - \frac{1}{2} \rho_{J} \\
s_{J, t+1} & = s_{J} - \frac{1}{2} \rho_{J} \\
n_{J, t+1} & = n_{J} + \frac{1}{2} \rho_{J}
\end{align*}

where 

\[
\rho_{J} \equiv g_{J}s_{J}.
\]

In words, when a group contains both g-types and s-types, some of
them marry each other and produce some b- and n-type offspring: this
increases the correlation between $G_{i}$ and $S_{i}$.

Summing over the groups, we can write the new generation's proportion
of types in the whole population as

\begin{align*}
b_{t+1} & = b_t + \frac{1}{2} \rho \\
g_{t+1} & = g_t - \frac{1}{2} \rho \\
s_{t+1} & = s_t - \frac{1}{2} \rho \\
n_{t+1} & = n_t + \frac{1}{2} \rho 
\end{align*}

where

\begin{equation}
\rho \equiv \theta \rho_{H} + (1 - \theta) \rho_{L}. 
\label{eq:rho}
\end{equation}

We can now calculate the covariance between $G$ and $S$ in the second
generation. The covariance is just $E(G_{i}S_{i}) - E(G_{i})E(S_{i})$;
in general, at generation $t$, this is $b_{t} - \gamma\sigma$. For
$t = 2$ this is just equal to $\rho$. 

In the first generation, we can calculate:

\begin{align*}
b_{H, 1} & = \gamma\sigma/\theta; \\
g_{H, 1} & = (1-k)\phi/\theta; \\
s_{H, 1} & = k\phi/\theta; \\
n_{H, 1} & = 0;
\end{align*}

where 

\[
\phi \equiv \theta - \gamma\sigma.
\]

Similarly:

\begin{align*}
b_{L,1} & =0;\\
g_{L,1} & =\frac{\gamma(1-\sigma)-\phi(1-k)}{1-\theta}\\
s_{L,1} & =\frac{(1-\gamma)\sigma-\phi k}{1-\theta}\\
n_{L,1} & =\frac{(1-\gamma)(1-\sigma)}{1-\theta};
\end{align*}

and from these

\begin{align*}
\rho_{H} & =\frac{\phi^{2}k(1-k)}{\theta^{2}};\\
\rho_{L} & =\frac{[\gamma(1-\sigma)-\phi(1-k)][(1-\gamma)\sigma-\phi k]}{(1-\theta)^{2}}.
\end{align*}

Hence:

\begin{align*}
\rho = & \frac{\phi^{2}k(1-k)}{\theta} + \\
       & \frac{[\gamma(1 - \sigma) - \phi(1 - k)][(1 - \gamma)\sigma -\phi k]}{(1 - \theta)}.
\end{align*}

Note that when $k=1$ and $\theta=\sigma$, $\rho$ evaluates to 0.
Similarly, when $k=0$ and $\theta=\gamma$, $\rho$ evaluates to
0. This confirms the claims in the main text about the two extreme
example societies.

$\rho$ is a quadratic in $k$. Differentiating $\rho$ by $k$ gives

\begin{align}
\frac{d\rho}{dk} & =\frac{1}{\theta}\phi^{2}(1-2k)+\frac{1}{(1-\theta)}[\phi^{2}(1-2k)+\phi(\sigma-\gamma)]\nonumber \\
 & =\frac{1}{\theta(1 - \theta)} \phi^{2}(1-2k) + \frac{1}{(1-\theta)}\phi(\sigma-\gamma)\nonumber \\
 & =\frac{1}{(1 - \theta)} \left[\frac{\phi^{2}}{\theta}(1-2k) + \phi(\sigma-\gamma)\right].\label{eq:d_rho_d_k}
\end{align}

This is decreasing in $k$, proving that $\rho$ is concave.

We find the maximum for $\rho$ by solving the first order condition.
In (\ref{eq:d_rho_d_k}), setting the term in square brackets to 0
gives:

\begin{equation}
k = \frac{1}{2} + \frac{1}{2}\frac{\theta}{\theta - \gamma\sigma}(\sigma - \gamma).
\label{eq:k_FOC}
\end{equation}

We need to show this is strictly between 0 and 1 as $\theta$ approaches
$\sigma$ or $\gamma$.

First assume $\sigma < \gamma$. As $\theta \rightarrow \sigma$, the
expression (\ref{eq:k_FOC}) approaches $k=\frac{1}{2} + \frac{1}{2}\frac{(\sigma-\gamma)}{(1-\gamma)}$.
The requirement for this to be interior is that $|\sigma-\gamma| < |1-\gamma|$.
For $\sigma<\gamma$ this is equivalent to $\gamma < (1+\sigma)/2$,
which holds by condition (\ref{eq:sigma-gamma-close}).

Next assume $\gamma < \sigma$. As $\theta \rightarrow \gamma$, (\ref{eq:k_FOC})
approaches $k = \frac{1}{2} + \frac{1}{2}\frac{(\sigma-\gamma)}{(1-\sigma)}$.
This is interior when $|\sigma-\gamma| < |1-\sigma|$,
equivalently when $\sigma < (1+\gamma)/2$, which again holds by (\ref{eq:sigma-gamma-close}).


## Proof of Proposition \@ref(prop:cor-alpha)

We can rewrite table \@ref(tab:child-shares) as:

\begin{center}
\begin{table}[h]
\begin{centering}
\begin{tabular}{ccccc}
\hline 
 & $b_{J}$ & $g_{J}$ & $s_{J}$ & $n_{J}$\tabularnewline

$b_{J}$ & $1;0;0;0$ & $\alpha;1-\alpha;0;0$ & $\frac{1}{2};0;\frac{1}{2};0$ & $\frac{\alpha}{2};\frac{1-\alpha}{2};\frac{\alpha}{2};\frac{1-\alpha}{2}$\tabularnewline

$g_{J}$ & $\alpha;1-\alpha;0;0$ & $0;1;0;0$ & $\frac{\alpha}{2};\frac{1-\alpha}{2};\frac{\alpha}{2};\frac{1-\alpha}{2}$ & $0;\frac{1}{2};0;\frac{1}{2}$\tabularnewline

$s_{J}$ & $\frac{1}{2};0;\frac{1}{2};0$ & $\frac{\alpha}{2};\frac{1-\alpha}{2};\frac{\alpha}{2};\frac{1-\alpha}{2}$ & $0;0;1;0$ & $0;0;\frac{1}{2};\frac{1}{2}$\tabularnewline

$n_{J}$ & $\frac{\alpha}{2};\frac{1-\alpha}{2};\frac{\alpha}{2};\frac{1-\alpha}{2}$ & $0;\frac{1}{2};0;\frac{1}{2}$ & $0;0;\frac{1}{2};\frac{1}{2}$ & $0;0;0;1$\tabularnewline
\hline 
\end{tabular}
\par\end{centering}
\caption{Proportions of children born, $\alpha$-rule for social inheritance}
\end{table}
\par\end{center}

TODO: complete!
