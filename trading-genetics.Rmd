---
title: "Trading social status for genetics in marriage markets: evidence from UK Biobank"
author: |
  Abdel Abdellaoui\thanks{Department of Psychiatry, Amsterdam UMC, University 
  of Amsterdam, Amsterdam, The Netherlands. Email: a.abdellaoui@amsterdamumc.nl},
  Oana Borcan\thanks{School of Economics, University of East Anglia, Norwich, 
  UK. Email: O.Borcan@uea.ac.uk}, 
  Pierre-Andr√© Chiappori\thanks{Department of Economics, University of Columbia, 
    New York. Email: pc2167@columbia.edu} &
  David Hugh-Jones\thanks{Corresponding author. School of Economics, 
  University of East Anglia, Norwich, UK. Email: D.Hugh-Jones@uea.ac.uk}
abstract: |
  Under social-genetic assortative mating (SGAM), socio-economic status (SES) and 
  genetics are both assets in marriage markets. They become associated in spouse 
  pairs, and are passed on together to future generations. This gives a new 
  explanation for the surprising persistence of intergenerational inequality, and 
  for observed genetic differences between high- and low-income people. 
  We model SGAM and test  for it in a large survey. Earlier-born siblings have
  spouses with genetic variants predicting more education. This effect is 
  mediated by individuals' own education and income. Thus, environmental shocks 
  to SES are reflected in the DNA of subsequent generations. SGAM provides a new
  channel from assortative mating to long-run inequality, and shows 
  that genetic variation is endogenous to economic institutions. 
date: "`r Sys.Date()`"
output: 
  bookdown::pdf_document2:
    toc: false
    latex_engine: xelatex
    number_sections: false
    keep_tex: true
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: 72
bibliography: bibliography.bib
mainfont: Times
fontsize: 12pt
linkcolor: blue
header-includes:
  - \usepackage{subfig}
  - \captionsetup[subfloat]{labelformat=empty}
  - \usepackage{setspace}\onehalfspacing
  - \usepackage{amsmath}
  - \usepackage{amsthm}
  - \usepackage{placeins}
  - \usepackage{etoc}
  - \newtheorem{prop}{Proposition}
  - \newtheorem{claim}{Claim}
---


```{r setup, include = FALSE}

library(robomit)
library(Formula)
library(car)
library(drake)
library(Hmisc)
library(dplyr)
library(magrittr)
library(AER)
library(ggplot2)
library(huxtable)
library(broom)
library(fixest)
library(santoku)
library(purrr)
library(scales) # percent should override santoku
library(systemfit)
library(nlWaldTest)

set.seed(27101975)

regression_subset <- function (data) {
  data %>% 
         filter(
           n_sibs.x >= 2, 
           n_sibs.x <= 6, 
           ! is.na(birth_order.x),
           ! is.na(height.x),
           ! is.na(fluid_iq.x),
           ! is.na(university.x),
           ! is.na(bmi.x),
           ! is.na(sr_health.x)
           # we don't demand first_job_pay.x is not NA, that would 
           # shrink the N by a lot
         )
}


calc_prop_shared_children <- function (mf_pairs) {
  drake::loadd(parent_child)
  # all pairs where at least 1 parent has a genetic child in the sample
  mf_w_parent <- mf_pairs %>% 
        left_join(parent_child, by = c("ID.m" = "parent_id")) %>% 
        left_join(parent_child, by = c("ID.f" = "parent_id"), 
                  suffix = c(".m", ".f")) %>% 
        filter(! is.na(child_id.m) | ! is.na(child_id.f))
  
  
  n_one_has_kid <- nrow(mf_w_parent)
  n_both_same_kid <- mf_w_parent %>% 
                        filter(child_id.m == child_id.f) %>% # NAs excluded
                        nrow()
  return(list(one = n_one_has_kid, both = n_both_same_kid))
}


pretty <- function (n, digits = 2, ...) {
  formatC(n, digits = digits, big.mark = ",", ...)
}


update_with_birth_order_dummies <- function (fml) {
  update(fml, . ~ . - birth_order.x + factor(birth_order.x))
}


knitr::opts_chunk$set(echo = FALSE)
knitr::knit_hooks$set(
  inline = function (x) {
    if (is.numeric(x)) x <- as.character(round(x, getOption("digits")))
    x <- gsub("-", "\u2212", x)
    paste(as.character(x), collapse = ", ")
  }
)
options(huxtable.long_minus = TRUE)
theme_set(theme_minimal())

drake::loadd(mf_pairs)
drake::loadd(mf_pairs_twice)
drake::loadd(famhist)
drake::loadd(resid_scores)

famhist %<>% left_join(resid_scores, by = "f.eid")
rm(resid_scores)
famhist$EA3 <- famhist$EA3_excl_23andMe_UK_resid

mf_pairs_reg <- regression_subset(mf_pairs_twice)

my_note <- "{stars}. Standard errors: robust."

# for p values
my_stars <- c(`***` = 0.001, `**` = 0.01, `*` = 0.05, `+` = 0.10)

# basic formulae
fml_bo_psea <- list()

fml_bo_psea[[1]] <- EA3.y ~ birth_order.x | factor(n_sibs.x)
fml_bo_psea[[2]] <- EA3.y ~ university.x + birth_order.x | factor(n_sibs.x)
fml_bo_psea[[3]] <- EA3.y ~ first_job_pay.x + birth_order.x | factor(n_sibs.x)
fml_bo_psea[[4]] <- EA3.y ~ first_job_pay.x + university.x + birth_order.x |
      factor(n_sibs.x)

fml_bo_psea <- lapply(fml_bo_psea, Formula::as.Formula)

# common controls
fml_bo_psea <- lapply(fml_bo_psea, update, 
                        . ~ . + EA3.x + par_age_birth.x)
fml_bo_psea <- lapply(fml_bo_psea, update, 
                        . ~ . | . + factor(YOB.x) + factor(birth_mon.x))

# alternative mediators
fml_bo_psea[-1] <- lapply(fml_bo_psea[-1], update,
                            . ~ . + fluid_iq.x + height.x + bmi.x + sr_health.x)

# basic tidy args
# tidy_args <- list(se = "cluster", cluster = "couple_id", conf.int = FALSE)
tidy_args <- list(se = "hetero", conf.int = FALSE)

reg_coefs <- c(
          "Birth order"           = "birth_order.x", 
          "University"            = "university.xTRUE", 
          "Income"                = "first_job_pay.x",
          "Fluid IQ"              = "fluid_iq.x",
          "Height"                = "height.x",
          "BMI"                   = "bmi.x",
          "Self-reported health"  = "sr_health.x",
          "Own PSEA"              = "EA3.x",
          "Parents' age at birth" = "par_age_birth.x"
        )

```

```{r TODO-NOTES, eval = FALSE}

# TODO - Apr 2022

* Versions of first stage with sibling FE? I did this, they are the right
  sign except for BMI, but never significant and with big SEs. Maybe doesn't
  add much.
* Extension with a ne b: does correlation increase in difference between a and b?
  DONE
* Oana, do analysis of missing mediator and how close it would have to correlate
  with univ. attendance to make our results insignificant
* What to do with the Chiappori et al style matching model? Ask Pierre
  DONE
* Comp statics of long run, using Imp Fun Thm;
  solve comp stats and do graphs
* Rework conclusion esp re $\theta$, $\gamma$
    DONE
* $E[x'_2 | x_2]$ and $E[x'_2 | x_1, x_2]$ in prop-gamma, 
  to show that $\sigma$ is a confound while $\gamma$ is a mediator?
* Connect theory to Oana's empirics
* G-E interactions? We mention in intro; could just mention it as a potential
  extension
  DONE


# * Why missing all the first job data? - because not everyone does the
#   online followup. We could use "current job" which might be endogenous
#   to your spouse; then do first job as a robustness check.
#   
# 
# * maybe - consider alternative exogenous shocks to income. For example, some # professions are more "cyclical" than others wrt recessions. If we could do 
# predicted income at age 21-25 from business cycle X profession, that might 
# count as exogenous. (Could use an independent source to estimate evolution
# of incomes, e.g. GHS or BHPS)
# 
# * Maybe: number of elder *brothers*? (We don't have this info but we have
#   total number of brothers, so we can interact this with the birth order
#   effect)
# 


# Check prop 2. (Bob question: if there's noise, then shouldn't
# correlation tend to a limit less than 1? And if so, then at that limit,
# parental correlation should equal child correlation).
# - I think the claim doesn't contradict this. But do double-check!


# TODO: We may have to control, rather than residualize, on PCs
# to get accurate p-values, as our N is not huge by the end (or is 2000 
# enough not to worry)

# Connect the model to existing theoretical models of matching 
# (e.g. Gale-Shapley, Becker 1974, econometrics of matching). DHJ.

# Robustness: look at all 33 polygenic scores for families of size 3. Rerun
# regressions excluding family size of 3. Appendix. DHJ.

# For future: consider gender asymmetries - e.g. does male SES matter more?
# Might need some other "good genes" measures e.g. waist-hip ratio.

# Maybe full set of birth order dummies within family size
# but maybe only for family size 2-4 or so?
# 

# * NB: why in mf_pairs_twice do we see differences in own EA3 with birth_order?
#   - just chance? it's only true for families of size 3...


# NOTES on economics literature
# Areas/topics
# * Econometrics of matching
#   - Choo & Siow 2006
#   - Chiappori et al 'fatter attraction'
#     - Quite simple regressions as a result of their basic framework
#     - Run regressions on each of the other person's characteristics;
#       in the linear version of their framework, coefficients should all be
#       proportional
#   - I'm not sure these guys are our key targets though, more likely some
#     people we might have to "appease"...!
# * Inheritance of inequality
# * Assortative mating
#   - a mechanism for inequality
#   - also related to family economics
#   - this might be a good way to set up the paper:
#   - "We bring together two explanations of persistent inequality. (1) Genetics
#     and (2) assortative mating."
#  * Getting comments from Greg Clark would be very useful.
#  * Maybe from Samuel Bowles too?
#  * They have a Science article on IG Wealth Transmission
#  * This special issue of Current Anthropology is important:
#    https://www.journals.uchicago.edu/toc/ca/2010/51/1
#    - they distinguish "material", "somatic" (inc genetic, but also e.g.
#      embodied knowledge), and "relational" wealth
#    - In their response to comments, Mulder et al. acknowledge that maybe 
#      one kind of wealth can help you acquire other kinds, and this is an
#      important area of future research.
#  * Fernandez et al. (Love and Money)
#    - inequality increases marital sorting because it increases the benefits
#      to matching with another skilled type;
#    - they confirm the correlation cross-country
#    - they also predict sorting lowers GDP (not sure how this works)
#    - there is a link with macroeconomics and the demographic transition in
#      this literature
#  * Eika et al. 2019
#    - Empirics of assortative mating in US from 1940s: it's increased at 
#      the bottom but gone down at the top
#    - Important for inequality but changes have led to little net increase
#      in inequality. (A simple accounting framework when you compare "what
#      if people had matched randomly into households")
#    - The motivation "assortative mating is increasing inequality" is 
#      a sufficient one, for this paper - it's a big issue.
#  * Doepke and Tertilt "families in macroeconomics"
#    - parents' fertility decisions are important for econ growth
#    - as is skill formation
#    - I think this is for another paper - e.g. what happens when the rich
#      have more children?
#  * Gould, Moav and Simhon 2008
#    - to read 
#    - relates end of polygyny to econ growth
#    - as above, maybe for another paper
#      
# PEOPLE you could talk to
# * Doepke
# * Clark
# * Fernandez
# * Bowles
```

\normalem

# Introduction

How families are formed, and transmit traits and assets to their offspring, is
crucial for understanding inequality. Assortative mating in marriage markets can
increase inequality across families [@breen2011educational; @greenwood2014marry]
and can contribute to the persistence of inequality across generations, which
is surprisingly high [@clark2015intergenerational;@solon2018we]. Assortative
mating has been studied by both economists and geneticists: homogamy in education
is well established, while genetic assortative mating has only been demonstrated
recently [@hugh2016assortative;@robinson2017genetic]. Similarly, wealthy
families pass on advantages to their children through both genetic inheritance
and environmental influence [@Rimfeld_2018; @bjorklund2006origins; @sacerdote2011nature].

This paper examines a plausible, not previously analysed aspect of the spouse
matching process: that both social status and genetics contribute to a person‚Äôs
attractiveness in marriage markets, and as a result, genetics and inherited
social status may become associated in subsequent generations.[^status-SES] For
example, suppose that wealth, intelligence and health are positive assets in a
potential spouse. Then wealthy people are more likely to marry intelligent or
healthy people, and their children will inherit both wealth, and genetic
variants associated with intelligence or health. We call this mechanism
social-genetic assortative mating (SGAM). SGAM may be an important channel for
the transmission of inequality. It leads to a hidden dimension of advantage for
privileged families ‚Äì hidden because most social science datasets do not include
genetic information. This dimension may help to explain the surprising long-run
persistence of inequality. At the
same time, this advantage is not an exogenous fact of biology, but endogenous to
the social structure. Indeed, under SGAM, environmental shocks to an
individual‚Äôs social status may be reflected in the genetics of his or her
children.

[^status-SES]: *Social status* refers to characteristics that an individual
  possesses in virtue of their social position. For example, my wealth
  is a fact about me that holds in virtue of my relationship to
  certain social institutions (bank deposits, title deeds et cetera).
  Other examples include caste, class, income, and educational
  qualifications. *Socio-economic status* (SES) is a specific type of
  social status which exists in economically stratified societies, covering
  variables like educational attainment, occupational class, income and 
  wealth [e.g. @white1982relation].


Below, we first outline a theoretical framework where attractiveness in the
marriage market is a function of both socio-economic status (SES) and genetic
variants. We show that social-genetic assortative mating in one generation
increases the correlation between SES and genetic variants in the offspring
generation. This result provides a new explanation of the *genes-SES gradient*,
that is, the systematic genetic differences between high- and low-SES people 
[@belsky2018genetic;@Rimfeld_2018;@bjorklund2006origins]. The 
dominant existing explanation for the gradient is meritocratic social mobility: 
if a genetic variant predicts success in the labour market, then it will 
become associated with high SES and will be inherited in high-SES families.
Under meritocracy, genes causes SES. By contrast, under SGAM, 
causality goes both ways, from genes to SES and vice versa. What's more, the
strength of the genes-SES gradient depends on economic institutions. Under
institutions which increase intergenerational mobility, like high inheritance
tax rates, the genes-SES gradient becomes weaker.

Next, using data on matched spouses born between 1935 and 1970 from UK Biobank
(a large genetically-informed survey), we test the hypothesis that an
individual‚Äôs higher social status attracts spouses with higher genetic potential
for educational attainment. Our genetic measure, the polygenic score for
educational attainment (PSEA), derives from large-scale genome-wide association
studies [@lee2018gene]. PSEA reflects a bundle of polygenic effects on
underlying traits, including intelligence, personality, and physical and mental
health [@demange2021investigating]. PSEA predicts, and causes, educational
attainment itself, as well as intelligence and labour market outcomes. It is
already known that humans mate assortatively on PSEA [@hugh2016assortative;
@robinson2017genetic], which makes it a likely candidate for detecting SGAM.

The endogeneity of socio-economic status is the main challenge in identifying
the effect of SES on the spouse‚Äôs genetic endowment. For instance,
individuals with high education qualifications tend to also have high PSEA, and
as mentioned above, they may take partners based on genomic similarity. Indeed,
recent studies show strong assortative mating on PSEA, much more than we would
expect if spouses matched only on observed measures of actual educational
attainment [@okbay2022polygenic]. To isolate the causal link from own SES to
partner's genes, we use the ‚Äúaccident of birth‚Äù as a shock to SES which is
independent of own genetics. Specifically, we use a person's *birth order* as
a ‚Äútreatment‚Äù which affects the identity of their partner, partly by affecting
their own SES. Earlier-born children are known to receive higher parental
investment and have better life outcomes, including measures of SES such as
educational attainment and occupational status [@black2011older;
@booth2009birth; @Lindahl_2008]. At the same time, the facts of biology, in
particular the so-called "lottery of meiosis", guarantee that siblings' birth
order is independent of their genetic endowments.[^interaction]

[^interaction]: @muslimova2020dynamic find that PSEA and birth order
*interact* to produce human capital.

Birth order could affect partner choice through both SES and non-SES mechanisms.
So, we run a mediation analysis similar to @heckman2013understanding,
decomposing the treatment effect into effects of measured and unmeasured
mediating variables. Specifically, we estimate a reduced-form model with spouse
polygenic scores for educational attainment (PSEA) as the dependent variable,
and own birth order as the main independent variable. We then add in to the
model measures of own socio-economic status, including university
attendance and estimated income in one's first job. Under certain assumptions,
these variables can be interpreted as mediating the effect of birth order on
spouse genetics.

We find that later-born children have spouses with significantly lower PSEA in
the reduced-form regressions. When we add mediators, including university
attendance and/or income, birth order is no longer independently significant,
while the SES mediators increase the spouse‚Äôs PSEA at 0.1% significance.
University attendance explains an estimated 38-55% of the effect of birth order,
and income explains about 10-13%. Thus, SES appears to mediate the effect of
birth order on spouse genetics. The results are robust to the inclusion of
several controls, including non-SES mediators, and a rich set of own genetic
traits.

Our paper contributes to several literatures. First, we study a new kind of
assortative mating. The economics literature on spouse matching has typically
focused on educational similarities [e.g.
@pencavel1998assortative;@chiappori2017partner] or social class or caste [e.g.
@abramitzky2011marrying;@banerjee2013marry], but also sorting based on age,
physical traits and ethnicity [@hitsch2010matching]. Matching decisions on the
marriage market follow multiple criteria, with some degree of substitutability
between them.[^others] For instance, @chiappori2012fatter showed that
individuals trade off BMI for partners‚Äô income or education and that the
marginal rate of substitution between these characteristics is different for men
and women. The genetics literature has focused on genetic assortative mating
(GAM), the phenomenon that people with similar genes marry each other. Recent
research has confirmed the long-standing conjecture that GAM takes place in
contemporary human populations [@hugh2016assortative;
@robinson2017genetic; @howe2019genetic]. Geneticists have also developed the
concept of cross-trait assortative mating [@Beauchamp_2010; @Sundet_2005;
@border2022cross]. This happens when e.g. people with genes for height marry
people with genes for intelligence, or people with genes for two different types
of disease trait marry each other. As a result, the two types of genetic
variation become associated. This paper brings the two literatures together,
extending cross-trait assortative mating to encompass social status as well as
genetic variants. Our results confirm that individuals with higher social status
attract spouses with genetics for higher educational attainment.

[^others]: @oreffice2010anthropometry show that height and BMI are associated 
with spouse earnings. @dupuy2014personality find spouse matching on multiple 
independent dimensions, including education, height, BMI and personality.

Secondly, SGAM may affect economic inequality and intergenerational mobility.
Intergenerational mobility correlates with cross-sectional inequality
[@becker2018theory;@krueger2012rise], which has risen dramatically in
high-income countries, while intergenerational absolute mobility has declined
[@western2008inequality;@chetty2017fading].[^stats] Long-run estimates of 
intergenerational persistence of wealth are often surprisingly high, i.e.
higher than would be predicted by parent-child correlations in wealth
[@clark2015intergenerational; @barone2021intergenerational;
@solon2018we]. @clark2021bell argues that this can be explained by an underlying
process where unobserved genetic variation determines wealth. We show below that
SGAM could also generate these patterns. The mechanism again is unobserved
genetic variation, but the interpretation is different, since genetic endowments
are not an exogenous source of variation, but an asset "traded" in marriage
markets in exchange for wealth and social status. Put another way, for Clark, in
analysing the effect of ancestral wealth on descendant wealth, genetics is a
*confound*; under SGAM, it may be a *mediator*.

[^stats]: Though relative mobility has been stable [@chetty2014united]. In the 
United Kingdom the Gini coefficient has increased from 26% to 34.6% between 1977 
and 2020. The United States has seen a 10 percentage point rise to 43.3% 
from 1962 to 2013.

SGAM also affects cross-sectional inequality, like other forms of assortative
mating [@fernandez2001sorting;@fernandez2005love;@eika2019educational;
@chiappori2018marriage]. We know that there is a "genes-SES gradient": many
genetic variants are associated with high or low SES. From twin studies, the
heritability of occupational class and educational attainment, i.e. the
proportion of variance explained by genetic differences between individuals, is
around 50% [@Tambs_1989]. Genome-wide Complex Trait Analysis (GCTA) shows that
the family socio-economic status of 2-year-old children can be predicted from
their genes [@Trzaskowski_2014]. Children born into higher-income families have
more genetic variants predicting educational attainment [@belsky2018genetic].
Studies comparing adoptees to non-adoptees show that both post-birth environment
and pre-birth conditions (genetics and to a lesser extent prenatal environment)
contribute to the transmission of wealth and human capital [e.g.
@bjorklund2006origins]. Thus, the genes-SES gradient is an important source of
inequality. Genetic variation in human capital is key, since a likely cause of
the recent rise in inequality is the increase in market returns to human capital
[e.g. @kaplan2013s; @eika2019educational]. There is also a
genes-SES gradient in genetic predictors of health. DNA-derived scores
predictive of several health outcomes are associated with regional economic
deprivation [@abdellaoui2019genetic]. There is a correlation between education
and health, which may be mediated by shared genetic causes [@amin2015schooling;
@boardman2015can]. Family SES correlates with several health-related polygenic
scores [@selzam2019comparing], and genetic effects associated with SES
significantly alter the genetic relationships between many mental health
outcomes [@marees2021genetic].

SGAM shows how marriage markets can lead high SES to be associated with
different genetic variants, i.e. it can explain the genes-SES gradient. The
standard explanation for the genes-SES gradient is returns to talent in labour
markets, also known as meritocracy. Parents with higher ability reap higher
market returns, and they may then pass both higher socio-economic status and
their genes to their children, leading to an association between the two
[@belsky2018genetic]. This mechanism depends on the level of meritocracy in
social institutions [@branigan2013variation; @Heath_1985]: in a society where
social status was ascribed rather than earned, it could not take effect. Indeed,
after the fall of communism in Estonia, the heritability of SES increased,
presumably because post-communist society allowed higher returns to talent
[@Rimfeld_2018]. By contrast, SGAM does not require meritocracy. Even when
social status is entirely ascribed, it can still become associated with certain
genetic variants, so long as their associated phenotypes are prized assets in
marriage markets. Since meritocracy is historically rare, while assortative
mating is universal, this suggests that genes-SES gradients are likely to be
historically widespread.

Both meritocracy and SGAM may increase social inequality overall, if there are
complementarities between genetic and environmental components of human capital, 
for example if higher-ability parents make more productive investments in
children‚Äôs human capital [@cunha2007technology; @cunha2010estimating;
@heckman2014economics; @kong2018nature], or if high-income parents are able to
invest more in transmitting their human capital [@becker2018theory]. Thus, by
bringing "good genes" and enriched environments together, SGAM may increase
inequality in the next generation.

Lastly, we contribute to a literature in economics that examines the
relationship between genetic and economic variables. @benjamin2011promises is an
early review. Several recent papers use polygenic scores, in particular
polygenic scores for educational attainment [@barth2020genetic;
@papageorge2020genes; @ronda2020family]. @barban2021effect use PSEA as an
instrument for education in a marital matching model. These papers --
like the vast majority of the behavior genetics literature [see e.g.
@plomin2008behavioral] -- take genetic endowments as exogenous and examine how
they affect individual outcomes, perhaps in interaction with the environment. We
take a different approach by putting genetics on the "left hand side". Thus, our
paper challenges the assumption, in economics and beyond, that genetic endowment
is exogenous to economic characteristics. While this may be tenable in
within-generation studies, it ceases to hold in intergenerational models.
Social-genetic assortative mating is a causal mechanism going from
socio-economic status to genes for heritable traits.

Also, our model shows that the strength of this mechanism is endogenous to
social and economic institutions. When SES is highly transmissible across the
generations, this has the long-run effect of increasing the association between
SES and genetics. If so, institutional reforms that increase *intergenerational
mobility*, like mass education or inheritance taxation, may in the long run
affect not only economic but genetic inequality. Conversely, an increase in
*economic meritocracy* increases the association between SES and genetics in the
long run.[^prop] This poses the problem raised by @young1958rise, and more
recently by @markovits2019meritocracy: meritocracy may be self-limiting or even
self-undermining.

[^prop]: See Proposition \@ref(prop-gamma) below.

The observations behind SGAM are not new. That status and physical
attractiveness assort in marriage markets is a commonplace and a perennial theme
of literature. In the Iliad, powerful leaders fight over the beautiful
slave-girl Bryseis. In Jane Austen‚Äôs novels, wealth, attractiveness and ‚Äúvirtue‚Äù
all make a good match. @marx1844economic wrote ‚Äúthe effect of ugliness, its repelling
power, is destroyed by money.‚Äù And Donald Trump claimed: ‚Äúpart of the beauty of
me is that I am very rich.‚Äù The literature on mate preference from evolutionary
psychology [@buss1986preferences; @buss1989sex; @buss2019mate] confirms
that attractive mate characteristics include aspects of social status (‚Äúhigh
earning capacity,‚Äù ‚Äúprofessional status‚Äù) as well as traits that are partly
under genetic influence (‚Äúintelligent,‚Äù ‚Äútall,‚Äù ‚Äúkind,‚Äù ‚Äúphysically
attractive‚Äù). Despite this, to our knowledge, this is the first paper in either
genetics or economics to formally analyse SGAM and its consequences.[^prev-work]

[^prev-work]: @halsey1958genetics showed in a two-class model that social
mobility combined with assortative mating might increase the association between
genetics and social class. @belsky2018genetic offer three reasons for the
association between education-linked genetics and SES, but do not consider SGAM.


```{r literature-notes, eval = FALSE}

# Notes 

# Fernandez et al 2005
# - skills are caused by investment in human capital
# - sorting is inefficient since it increases inequality of parents' capital
# and some people will be credit-constrained.
# 
# Marry Your Like (Greenwood 2014)
# - simple accounting methodology
# - ass mating has increased and has contributed to increase in inequality in the 
#   US, 1960 to 2005
#   
# Eika 2019
# - assortative mating has decreased among highly educated, increased among low
#   educated, 1960s-2010s. Overall, increase only until the 1980s
# - changes in ass mating barely move time trends in household income inequality
# - findings for US + 4 European countries

# Clark 201x - surname groups show higher intergen transmission of wealth 
# than 
# individual parent-child pairs. Also grandparents matter independently. 
# One explanation: underlying "social status" or "social competence" which
# is measured with error by wealth.

# Solon 2018 - reviews evidence on long-run transmissibility. Not
# much evidence for Clark's "0.7". Many alternative explanations.

# Becker-Tomes 1979?
```


# Model

```{r model-section, child="model-section.Rmd"}

```


# Data and methods

In modern societies, both SGAM and meritocratic mobility may be at play. Genetic 
variants that cause higher SES, e.g. higher income and wealth,
will be passed down along with that status. At the same time, higher SES and "good
genes" will assort in the marriage market. To test this, we look at correlations
among spouses between one partner's SES and the other partner's genetics.


```{r calc-validate-pairs}

prop_shared <- calc_prop_shared_children(mf_pairs)
n_one_has_kid <- prop_shared$one
n_both_same_kid <- prop_shared$both

```


We use data from the UK Biobank, a study of about 500,000 individuals born
between 1935 and 1970 [@bycroft2018uk]. The Biobank contains information on respondents'
genetics, derived from DNA microarrays, along with questionnaire data on health
and social outcomes. The Biobank does not contain explicit information on spouse 
pairs. We categorize respondents as pairs if they:

-   had the same home postcode on at least one occasion;[^4]
-   both reported the same homeownership/renting status, length of time
    at the address, and number of children;
-   attended the same UK Biobank assessment center on the same day;
-   both reported living with their spouse ("husband, wife or partner");
-   consisted of one male and one female.

[^4]: A typical UK postcode contains about 15 properties.

```{r estimate-false-positives, eval = FALSE}
# We can use the number of duplicates to estimate our "false positive"
#   ratio. Suppose that a proportion x of our pairs are false positives who 
#   just live in the
#   same postcode. Suppose UKBB samples a proportion y of people in each postcode. 
#   Then the number of duplicates will be xy. 
#
# Note to calculate xy we need to count *whenever* they 
# appear in the mf_pairs file. I.e. if they are false positives, we want
# to catch them matching with someone else.


# code to estimate y:
# in the alto_file, count how many people are observed at the same coordinate
alto <-readr::read_csv(alto_file)

# count how many people are *not* in the alto file (i.e. for them,
# people_at_same_coordinate should be 1. Indeed in alto, the min is 2.)
# 500K is about right :-)
not_in_alto <- 500000 - length(unique(alto$ID))

all_per_coord <- c(alto$people_at_same_coordinate[! duplicated(alto$coordinate_ID)]
                   , rep(1, not_in_alto))
n_at_same <- mean(all_per_coord)

# this is "y" above:
sample_prop_per_coord <- n_at_same / 15 # 15 people in a postcode on average

# to calculate xy:
# start with our "purified" sample mf_pairs, but without deleting any duplicates
# count how many are duplicates in the sense that they are ever at the 
# same coordinate with someone else

mf_pairs_tmp <- readr::read_csv(mf_pairs_file)

mf_pairs_tmp$eid.x <- mf_pairs_tmp$ID.m
mf_pairs_tmp$eid.y <- mf_pairs_tmp$ID.f
mf_pairs_tmp <- add_data_to_pairs(mf_pairs_tmp, famhist, resid_scores, 
                                suffix = c(".m", ".f"))

mf_pairs_tmp %<>% filter(
                f.680.0.0.f  == f.680.0.0.m,  # same rent/own status
                f.699.0.0.f  == f.699.0.0.m,  # same length of time in hh
                f.709.0.0.f  == f.709.0.0.m,  # same n occupants of hh
                n_children.f == n_children.m, # same n kids
                f.54.0.0.f   == f.54.0.0.m,   # same assessment center 
                f.53.0.0.f   == f.53.0.0.m,   # attended assessment same day
                f.6141.0.0.f == 1,            # both living with spouse
                f.6141.0.0.m == 1,            #   "     "     "    "
                female.m != female.f,         # heterosexual couples only
              )

mf_pairs_ids <- unique(c(mf_pairs_tmp$ID.m, mf_pairs_tmp$ID.f))

# observed duplicate proportion, using the alto ID. This also counts
# people of the same sex, is that right?

dupe_ids <- intersect(mf_pairs_ids, alto$ID[duplicated(alto$ID)])
# this is "xy" above
observed_dupe_prop <- length(dupe_ids)/length(mf_pairs_ids)

# so "x" above is: hmm, not quite right yet, this is > 1!!
estimated_false_pos <- observed_dupe_prop/sample_prop_per_coord

```

We also eliminate all pairs where either spouse appeared more than once
in the data. This leaves a total of `r pretty(nrow(mf_pairs))` pairs. Some of
these could be false positives, i.e. people who are not each others'
spouse but simply live in the same postcode. To validate the accuracy of
our pairs, we use genetic relationships. Some respondents in the UK
Biobank sample have a child (inferred from genetic data) who is also in the 
sample. Among our spouse pairs, `r n_one_has_kid` have a genetic
child of at least one partner in the sample. For `r n_both_same_kid` of
these, the child is the genetic child of both partners. If this
subsample is representative, then at least
`r percent(n_both_same_kid/n_one_has_kid)` of the pairs who have had a
child, have had a child together. This is a lower bound, because those
who had a child with someone else may also have had a child with their partner
who is not in the UK Biobank sample. As a point of comparison, 11% of families
with dependent children included a stepchild in England and Wales in
2011 [@ons2011stepfamilies].

It is still possible that some pairs in our data may not be actual spouses. In
the appendix, to sign any possible bias in our estimates resulting from this, we
use a dataset of "known fake" pairs. We show that estimated coefficients of
interest are closer to zero among these fake pairs than among our candidate
"real pairs". Because of this, any fake pairs remaining in our data are likely
to bias our coefficients towards zero.

Our key dependent variable is spouse's *Polygenic Score for Educational
Attainment* (PSEA). A polygenic score is a DNA-derived summary measure
of genetic risk or propensity for a particular outcome, created from
summing small effects of many common genetic variants, known as Single
Nucleotide Polymorphisms (SNPs). We focus on PSEA rather than other
polygenic scores for two reasons. First, educational attainment plays a key role in
human mate search. People are attracted to educated potential partners
[@buss1986preferences; @belot2013dating]; spouse pairs often have
similar levels of educational attainment, as well as similar PSEA
[@vandenberg1972assortative; @schwartz2005trends; @greenwood2014marry;
@hugh2016assortative]. Second, PSEA predicts a set of important socioeconomic
variables, including not only education but also social and geographic mobility, 
IQ, future income and wealth [@belsky2016genetics; @barth2020genetic; @papageorge2020genes].[^discuss]

[^discuss]: See @papageorge2020genes for a detailed discussion of polygenic 
scores, aimed at economists.

```{r calc-psea-check}

mod_own_psea <- feols(university ~ EA3, data = famhist, note = FALSE)
mod_own_psea_within <- feols(university ~ EA3 | sib_group, data = famhist,
                               note = FALSE)

n_own_psea <- glance(mod_own_psea)[["nobs"]]
n_own_psea_within <- glance(mod_own_psea_within)[["nobs"]]

mod_own_psea <- tidy(mod_own_psea)
mod_own_psea_within <- tidy(mod_own_psea_within)

eff_own_psea  <- mod_own_psea[[2, "estimate"]]
pval_own_psea <- mod_own_psea[[2, "p.value"]]

eff_own_psea_within  <- mod_own_psea_within[[1, "estimate"]]
pval_own_psea_within <- mod_own_psea_within[[1, "p.value"]]

stopifnot(pval_own_psea < 2e-16)
stopifnot(pval_own_psea_within < 2e-16)

n_with_job_codes <- sum(! is.na(mf_pairs_reg$first_job_pay.x))
```


We calculate PSEA using per-SNP summary statistics from @lee2018gene,
re-estimated excluding UK Biobank participants.[^5] We normalize the score to
have mean 0 and variance 1. Because polygenic scores are created from estimates
of many presumably tiny effects, they contain a large amount of noise relative
to the true best estimator that could be derived from genetic data. For
instance, PSEA explains only 11‚Äì13% of variance in educational attainment [out
of sample, @lee2018gene], whereas the true proportion explained by genetic
variation -- the heritability -- is estimated from twin studies to be about 40%
[@branigan2013variation]. In addition, polygenic scores are no more guaranteed
to be causal than any other independent variable. For example, social
stratification by ancestry may lead genes to be associated with educational
attainment even if they play no causal role [@selzam2019comparing].

[^5]: PSEA was computed by summing the alleles across \~1.3 million
    genetic variants weighted by their effect sizes as estimated in
    genome-wide association studies (GWASs) that excluded UK Biobank.
    PSEA was then residualized on the first 100 principal components of
    the SNP array data. Further details can be found in
    @abdellaoui2019genetic.

Despite these points, PSEA has non-trivial estimated effects on educational
attainment. PSEA correlates with measures of education, including university
attendance and years of full-time education. Effect sizes are smaller but still
non-trivial in within-siblings regressions [@lee2018gene]. These effects can be
interpreted as causal, since genetic variation across siblings is guaranteed to
be random by the biological mechanism involved -- the "lottery of meiosis" (see
below). We recheck these facts within the UK Biobank sample. In a simple linear
regression (N = `r pretty(n_own_psea)`) of university attendance on PSEA, a
one-standard-deviation increase in PSEA was associated with a 
`r pretty(eff_own_psea*100)` percentage point increase in the probability of
university attendance ($p < 2 \times 10^{-16}$). In a within-siblings regression
among genetic full siblings (N = `r pretty(n_own_psea_within)`), the increase
was `r pretty(eff_own_psea_within * 100)` percentage points ($p < 2 \times
10^{-16}$). This suggests that about half of the raw correlation of PSEA with
university attendance is down to environmental confounds like parental nurture,
while the remainder is causal. Still, the causal effect remains substantial: for
a rough comparison, the (ITT) effect on college attendance of the Moving To
Opportunity experiment in the US was 2.5 percentage points [@chetty2016effects].

We use two measures of socio-economic status: income, and university attendance.
Income is a direct measure of SES. University attendance is a predictor of
income over the whole life course, and a form of SES in itself. The UK Biobank
data only contains a direct measure of current household income, which is
inappropriate for our purposes because it includes income from both spouses and
is measured after marriage. Instead, we estimate income in ¬£000s in the
respondent's first job, by matching the job's Standard Occupational
Classification (SOC) code with average earnings by SOC from @ONS2007ASHE. Job
codes are only available for a subset of `r n_with_job_codes` respondents among
our pairs.

Figure \@ref(fig:pic-basic-corr) illustrates the core idea of SGAM within our
pair data. The X axis shows a measure of one partner's socio-economic status:
university attendance or income. The Y axis plots the other partner's mean PSEA.
Both males and females who went to university had spouses with higher PSEA. So
did males and females with higher income in their first job. Since DNA is
inherited, these people's children will also have higher PSEA.

```{r pic-basic-corr, fig.cap = "Spouse PSEA against own university attendance and own income in first job. Lines show 95\\% confidence intervals.", fig.subcap = rep("", 4), fig.align = "center", fig.width = 3, fig.height = 3, fig.ncol = 2}

pic_ss <- stat_summary(fun.data = mean_cl_normal, na.rm = TRUE)
pic_cc <- coord_cartesian(ylim = c(-0.15, 0.25))
pic_theme <- theme(axis.title = element_text(size = 10))
mf_pairs %>% 
      filter(! is.na(university.m)) %>% 
      mutate(University = ifelse(university.m, "Yes", "No")) %>% 
      ggplot(aes(University, EA3.f)) + 
        pic_ss + 
        pic_cc + 
        pic_theme +
        labs(x = "Male spouse university attendance", y = "Female spouse PSEA")
        

mf_pairs %>% 
      filter(! is.na(university.f)) %>% 
      mutate(University = ifelse(university.f, "Yes", "No")) %>% 
      ggplot(aes(University, EA3.m)) + 
        pic_ss + 
        pic_cc +
        pic_theme +
        labs(x = "Female spouse university attendance", y = "Male spouse PSEA")


pic_ss <- stat_summary(
            fun.data = mean_se, 
            fun.args = list(mult = 1.96), 
            na.rm = TRUE
          )
pic_cc <- coord_cartesian(ylim = c(-0.15, 0.25))

mf_pairs %>% 
      filter(! is.na(first_job_pay.m)) %>% 
      mutate(Income = santoku::chop_deciles(first_job_pay.m, labels = 1:10)) %>% 
      ggplot(aes(Income, EA3.f)) + 
        pic_ss + 
        pic_theme +
        labs(x = "Male spouse income decile", y = "Female spouse PSEA")

mf_pairs %>% 
      filter(! is.na(first_job_pay.f)) %>% 
      mutate(Income = santoku::chop_deciles(first_job_pay.f, labels = 1:10)) %>% 
      ggplot(aes(Income, EA3.m)) + 
        pic_ss + 
        pic_theme +
        labs(x = "Female spouse income decile", y = "Male spouse PSEA")
```


These figures do not prove that SGAM is taking place. Since an
individual's own PSEA correlates with both their educational attainment,
and their income, both figures could be a result of genetic assortative
mating (GAM) alone [@hugh2016assortative]. Indeed, recent studies show much
higher levels of GAM than could be explained by matching on the observed 
education phenotype alone [@okbay2022polygenic]. So, to demonstrate SGAM, we need
a source of social status which is exogenous to genetics. Also, the link
between social status and spouse genetics is likely to be noisy, for
three reasons: first, polygenic scores contain a large amount of error, as
discussed above; second, causal mechanisms behind variation in social status 
are likely to be noisy; third, to paraphrase @shakespeare1595midsummer, the 
spouse matching process is highly unpredictable. So, we need a large N to
give us sufficient power. This rules out time-limited shocks such as
changes to the school leaving age [@Davies_2018].

We use *birth order*. It is known that earlier-born children receive more
parental care and have better life outcomes, including measures of SES such as
educational attainment and occupational status [@Lindahl_2008; @booth2009birth;
@black2011older]. On the other hand, all full siblings have the same *ex ante*
expected genetic endowment from their parents, irrespective of their birth
order. This is guaranteed by the biological mechanism of meiosis, which ensures
that any gene is transmitted from either the mother or the father to the 
child, with independent 50% probability [@mendel1865experiments;@lawlor2008mendelian].
For example, siblings' expected polygenic score is equal to the mean of
their parents' polygenic scores.[^6] We can therefore use birth order as a
"shock" to social status. We put "shock" in quotes because we do not claim that birth
order is exogenous to all other variables. For example, it naturally correlates
with parental age, and it may also correlate with household SES at the time of
birth. We only claim that birth order is exogenous to genetic variation.

[^6]: Although genetic variation is randomly assigned to children at
    birth, genetics and birth order could be dependent if parents'
    choice of whether to have more children is endogenous to the genetic
    endowment of their earlier children. We check for this below. 
    @isungset2021birth also find that birth order differences in education are
    not genetic.

Our main independent variable is respondents' birth order, i.e. their
number of elder siblings plus one. For controls we use family size, i.e.
respondents' total number of siblings including themselves; month of birth; age
at interview; respondents' own PSEA; and their father's and/or mother's age
at their birth (calculated from parent's current age, only available if
the parent was still alive). For most regressions, we use only
respondents with between 1 and 5 siblings, i.e. with a family size of
2-6. 


## Decomposing the birth order effect on spouse genetics

Ideally, we might prefer to use birth order as an instrument for SES. However,
our measures of social status are noisy and incomplete. For example, we know
whether subjects attended university, but not which university. Birth order
likely affects both measured and unmeasured aspects of SES. So, an instrumental
variables approach would be likely to fall foul of the exclusion restriction.

Instead, we conduct a mediation analysis, following the strategy of
@heckman2013understanding. We first confirm that birth order affects our
measures of respondents' SES (income and education). Then, we regress spouse's
PSEA on birth order, with and without controlling for SES. Under the assumption
that birth order is exogenous to own genetics, these regressions identify the
effect of birth order, plus other environmental variables that correlate with
it, on own social status and spouse's genetics. Most importantly, if the 
estimated effect of birth order on spouse's PSEA changes when SES is controlled 
for, that is evidence that SES mediates the effect of birth order.

We follow @heckman2013understanding to decompose the aggregate treatment
effect into components due to observed and unobserved proximate channels
affected by the treatment. Our aim is to estimate the effect of SES (as
an effect of birth order) on spouse PSEA.

Assume $B$ is a multivalued variable indicating birth order. Let $Y_b$ be
the counterfactual outcome (spouse PSEA) for the first-born, second-born etc.
Given $b$, spouse PSEA is assumed to be independent across observations
conditional on some predetermined controls which are assumed not to be affected
by $B$.

Let $m_{b}$ be a set of mediators, i.e. proximate outcomes
determined by $b$, which account (at least in part) for the $b$
treatment effect on spouse PSEA. We can think of $m_{b}$ as all
the effects on attractiveness, such as increments to SES, health,
cognitive and non-cognitive skills, that individuals receive due to
their birth rank. We can split the mediators in $m_b$ into a set $J_m$ of
measured mediators, including university attendance and income in first job, 
and a set $J_u$ of mediators that we cannot measure. 

Our linear model is:

\begin{equation}
\label{eq:linear-model}
Y_b = \kappa_b + \sum_{j \in J_m} \alpha_b^j m^j_b+\sum_{j \in J_u} \alpha_b^j m^j_b + \mathbf{X^\prime} \symbf{\beta_b} + \tilde{\varepsilon}_b = \tau_b + \sum_{j \in J_m} \alpha_b^j m^j_b + \mathbf{X^\prime} \symbf{\beta_b} + \varepsilon_b 
\end{equation}


where $\tilde{\varepsilon}_b$ is a mean-zero residual assumed independent of
$m_b$ and $\mathbf{X}$; 
$\tau_b = \kappa_b + \sum_{j \in J_u} \alpha_b^j E(m^j_b)$; and 
$\varepsilon_b = \tilde{\varepsilon}_b + \sum_{j \in J_u} (m^j_b - E(m^j_b))$.
We simplify by assuming that $\beta_b = \beta$
and $\alpha_b = \alpha$ for all $b$, i.e. that the effects of $\mathbf{X}$ and
$m_B$ don't differ by birth order.[^assumptions] We assume differences in
unmeasured investments due to $b$ are independent of $\mathbf{X}$.

[^assumptions]:Under the assumption that measured and unmeasured mediators are
uncorrelated, we can test these assumptions by running an OLS regression of an
extended model \@ref(eq:model-to-estimate) where we interact the measured
mediators and controls with the treatment $B$, and test the significance of the
coefficients on the interaction terms ($\symbf{\alpha_b}=0$ and
$\symbf{\beta_b}=0$). See @heckman2013understanding and @fagereng2021wealthy 
for details and different applications. When we run the model with interactions,
only one interaction is significant after Bonferroni correction at $p < 0.05/34$:
the interaction of income in first job with the dummy for birth order 6. So 
overall, the uninteracted model seems a good enough approximation.

We use a linear model for each observed mediator variable:
\begin{equation}
\label{eq:mediator-model}
m^j_b=\mu_{0,j}+\mathbf{X^\prime}\symbf{\mu_{1,j}}+\mu_{2,j}\cdot b+\eta_j, j \in J_m  
\end{equation}
where \(\eta_j\) is a mean-zero residual. We also assume the treatment-specific 
intercepts are linear in $b$:
\begin{equation}
\label{eq:linear-intercept}
\tau_b=\tau_{0}+\tau b.  
\end{equation}

With the simplifying assumptions above and substituting \@ref(eq:mediator-model)
and \@ref(eq:linear-intercept) into \@ref(eq:linear-model) we obtain:
\begin{equation}
\label{eq:simplified-model}
Y_b = \tau_0+\tau b + \sum_{j \in J_m} \alpha^j (\mu_{0,j}+\mathbf{X^\prime}\symbf{\mu_{1,j}}+\mu_{2,j}\cdot b+\eta_j) + \mathbf{X^\prime} \symbf{\beta} + \varepsilon_b 
\end{equation}

Using equation \@ref(eq:simplified-model), we can decompose the average treatment 
effect of a change from birth order $b$ to $b'$ into the effect of measured mediators 
$m^j$ and unmeasured mediators on the outcome:

\begin{equation}
\label{eq:decomposition}
E(Y_b' - Y_b) = \tau(b' - b) + \sum_{j \in J_m} \alpha^j E(m^j_{b'} - m^j_b) \\
=\underbrace{\tau(b' - b)}_{\text{Direct effect + unmeasured mediators}} + \underbrace{\sum_{j \in J_m} \alpha^j \mu_{2,j} (b' - b)}_{\text{Effect of measured mediators}}
\end{equation}

We are primarily interested in estimating the effect of SES on spouse PSEA,
amongst the measured mediators, and furthermore we would like to measure the
relative importance of SES compared to other factors in predicting spouse PSEA.

We therefore estimate: 
\begin{equation}
\label{eq:model-to-estimate}
Y = \tau_0 + \tau B + \sum_{j \in J_m} \alpha^j m^j_b + \mathbf{X'} \symbf{\beta} + \varepsilon
\end{equation}


Estimating the above by OLS will generate unbiased estimates of
$\alpha^j$ if $m^j$ is measured without error and is
uncorrelated with the error term $\varepsilon$. Since
$\varepsilon$ contains both individual disturbances and differences
in unmeasured investments due to birth order, there are two identifying assumptions that need to hold for unbiased OLS estimates: (a) the measured investments
(specifically SES) should be independent of unmeasured investments
generated by birth order. Failing this, the estimates of $\alpha^j$ will be
conflated with the effects of unmeasured investments. Second, (b) the measured
investments should be uncorrelated with other shocks $\tilde{\varepsilon}_b$.

By running a least square regression of \@ref(eq:model-to-estimate), we can
estimate $\tau$ and $\alpha^j$. If assumption (a) holds, the part of the birth
order treatment effect on spouse PSEA that is due to measured mediators,
including SES, can be constructed using the estimated $\alpha^j$ and the effects
of birth order on measured mediators. We can estimate these effects in a second
step, from OLS regressions based on equation \@ref(eq:mediator-model) for each
measured mediator (in particular university attendance and income) on
$\mathbf{X}$ and $B$. The part of the birth order effect that is due to
university attendance (or income) on spouse PSEA will be the coefficient of
university/income in the regression of spouse PSEA in equation
\@ref(eq:model-to-estimate), multiplied by the coefficient of birth order on
university/income from equation \@ref(eq:mediator-model).

# Results


```{r tbl-bo-first-stage}
fml_bo_1st <- list()
fml_bo_1st[["University"]] <- update(fml_bo_psea[[1]], university.x ~ . )
fml_bo_1st[["Income"]] <- update(fml_bo_psea[[1]], first_job_pay.x ~ .)
fml_bo_1st[["Fluid IQ"]] <- update(fml_bo_psea[[1]], fluid_iq.x ~ . )
fml_bo_1st[["Height"]] <- update(fml_bo_psea[[1]], height.x ~ .)
fml_bo_1st[["BMI"]] <- update(fml_bo_psea[[1]], bmi.x ~ .)
fml_bo_1st[["Health"]] <- update(fml_bo_psea[[1]], sr_health.x ~ .)

mod_bo_1st <- purrr::map(fml_bo_1st, fixest::feols, data = mf_pairs_reg, 
                           notes = FALSE)

coef_bo <- purrr::map(mod_bo_1st, tidy) %>%
             purrr::map(filter, term == "birth_order.x") %>% 
             purrr::map_dbl("estimate")

tbl_note <- paste("Estimates from OLS regressions with the ",
"mediators (university attendance, income, fluid IQ, height, BMI, self-reported",
"health) as dependent",
"variables, and own birth order as the main independent variable. PSEA is the",
"polygenic score for educational attainment, which is normalized with mean 0 and",
"standard deviation 1. We include parents' age at birth (the mean of parents'", 
"ages) and further controls to ensure the balance of covariates across birth", 
"order. All data is from the UK Biobank for a sample of UK individuals born", 
"between 1935 and 1970.", my_note)

huxreg(mod_bo_1st, 
         coefs = c(
           "Birth order" = "birth_order.x", 
           "PSEA" = "EA3.x",
           "Parents' age at birth" = "par_age_birth.x"
         ),
         statistics = c(
           "N"  = "nobs", 
           "R2" = "r.squared"
          ),
         note = tbl_note,
         stars = my_stars,
         tidy_args = tidy_args
       ) %>% 
       insert_row(after = 7, "Family size dummies", rep("Yes", 6)) %>% 
       insert_row(after = 8, "Birth month dummies", rep("Yes", 6)) %>% 
       insert_row(after = 9, "Birth year dummies", rep("Yes", 6)) %>% 
       set_bottom_border(8:9, everywhere, 0) %>% 
       set_align(8:10, -1, "center") %>% 
       set_number_format(2:7, -1, 4) %>% 
       set_width(1) %>% 
       set_caption("Regressions of mediators on birth order")
       
```


We first regress our measures of socio-economic status, university attendance
and income from first job, on birth order in our sample. We also do the same for
four non-SES mediators that could be affected by birth order: fluid IQ, height,
body mass index (BMI) and a measure of self-reported health. We control for
respondent's own PSEA and their parents' age at birth (see below). Table
\@ref(tab:tbl-bo-first-stage) shows that birth order significantly predicts all
these variables. Effect sizes are quite substantial: on average, one extra elder
sibling reduces the chance of attending university by about 
`r pretty(-coef_bo["University"] * 100)` percentage points, income by about 
¬£`r pretty(-coef_bo["Income"] * 1000, format = "d")`, fluid IQ by about 
`r pretty(-coef_bo["Fluid IQ"])` points on a 13 point test, height by about 
`r pretty(-coef_bo["Height"])` centimeters, and self reported health by 
`r pretty(-coef_bo["Health"])` points on a 4-point scale; and increases BMI by 
`r pretty(coef_bo["BMI"])`.
 
Next we run regressions of spouse PSEA on birth order, within our dataset of
spouse pairs. Table \@ref(tab:tbl-bo-psea-basic) reports the results. Column 1
reports results controlling only for family size (using dummies). As expected,
higher birth order is negatively associated with spouse's PSEA, though the
estimated effect size is small and insignificant. Column 2 reports results
controlling for the respondent's own PSEA, as well as dummies for birth year to
control for cohort effects, and dummies for birth month to control for
seasonal effects. The effect size of birth order is not much changed.

Column 3 reports results controlling for parents' age at birth. Within a family,
later children have older parents by definition. Older parents have more life
experience and may have higher income, which would presumably help later
children.[^7] Including parents' age means we can separate the effect of
parental age from birth order. This reduces the N by a lot, since only
respondents with a live parent reported the necessary data. However, the effect
of birth order jumps in size and becomes significant at the 5 per cent level.
Meanwhile, parents' age has a positive effect. This suggests that estimates in
columns 1-2 mixed two opposite-signed effects: having older parents versus being
later in birth order.

[^7]: We often only have data only for one parent. We use this, or take the mean
if we have both. There are also potential genetic effects from parental age,
though recent research has rejected these in favour of "social" explanations
[@kristensen2007explaining; @black2011older]. @cochran2013paternal report that
mutational load is approximately linear in father's age, while it is constant in
mother's age. We observe very similar results if we control only for father's
age at respondent's birth.


```{r tbl-bo-psea-basic}

fml_bo_psea_base <- list()

fml_bo_psea_base[[1]] <- EA3.y ~ birth_order.x | factor(n_sibs.x)
fml_bo_psea_base[[2]] <- EA3.y ~ birth_order.x + EA3.x + factor(birth_mon.x) |
                            factor(n_sibs.x) + factor(YOB.x)
  
fml_bo_psea_base[[3]] <- EA3.y ~ birth_order.x + EA3.x + factor(birth_mon.x) +
                            par_age_birth.x | factor(n_sibs.x) + factor(YOB.x)

fml_bo_psea_base <- lapply(fml_bo_psea_base, Formula::as.Formula)


mod_bo_psea_base <- lapply(fml_bo_psea_base, fixest::feols, 
                 data = mf_pairs_reg,
                 notes = FALSE
               )

tbl_note <- paste("Estimates from OLS regressions with spouse PSEA as dependent",
"variable, and own birth order as the main independent variable. PSEA is the",
"polygenic score for educational attainment, which is normalized with mean 0 and",
"standard deviation 1. We include own PSEA, parents' age at birth (the mean of parents'",
"ages), and further controls (family size, birth year, and birth month dummies) 
in columns 2-3 to ensure the balance of covariates",
"across birth order. All data is from the UK Biobank for a sample of UK",
"individuals born between 1935 and 1970.", my_note)

huxreg(mod_bo_psea_base, 
         coefs = c(
           "Birth order"           = "birth_order.x", 
           "Own PSEA"              = "EA3.x",
           "Parents' age at birth" = "par_age_birth.x"
         ),
         statistics = c(
           "N"  = "nobs", 
           "R2" = "r.squared"
          ),
         note = tbl_note,
         stars = my_stars,
         tidy_args = tidy_args
       ) %>% 
       insert_row(after = 7, "Family size dummies", rep("Yes", 3)) %>% 
       insert_row(after = 8, "Birth month dummies", "No", "Yes", "Yes") %>% 
       insert_row(after = 9, "Birth year dummies", "No", "Yes", "Yes") %>% 
       set_bottom_border(8:9, everywhere, 0) %>% 
       set_align(8:10, -1, "center") %>% 
       set_number_format(2:7, -1, 4) %>% 
       set_width(0.9) %>% 
       set_caption("Regressions of spouse PSEA on birth order")


```

Having tested that birth order affects spouse's PSEA, we now look for
potential mediators of this effect. Despite the lower N, we continue to
control for respondents' parents' age, since this removes a confound
which would bias our results towards zero.[^9]

[^9]: The appendix reports results without controlling for parents' age.

```{r tbl-bo-psea}


mod_bo_psea <- lapply(fml_bo_psea, fixest::feols, 
                 data = mf_pairs_reg,
                 notes = FALSE
               )

tbl_note <- paste("Estimates from OLS regressions with spouse PSEA as dependent",
"variable, and own birth order and mediators (university attendance and income)",
"as the main independent variables. Columns 2-4 correspond to model 7. PSEA is", 
"the polygenic score for educational attainment, which is normalized with mean 0",
"and standard deviation 1. We include own PSEA, mean of parents‚Äô ages at birth,",
"potential non-SES mediators (fluid IQ, height, BMI, self-reported health)",
"and further controls (family size, birth year, and birth month dummies)",
"to ensure the balance of",
"covariates across birth order. All data is from the UK Biobank for a sample of", 
"UK individuals born between 1935 and 1970.", my_note)

huxreg(mod_bo_psea, 
         coefs = reg_coefs,
         note = tbl_note,
         stars = my_stars,
         tidy_args = tidy_args
       ) %>% 
       insert_row(after = 19, "Family size dummies", rep("Yes", 4)) %>% 
       insert_row(after = 20, "Birth month dummies", rep("Yes", 4)) %>% 
       insert_row(after = 21, "Birth year dummies", rep("Yes", 4)) %>% 
       set_bottom_border(20:21, everywhere, 0) %>% 
       set_align(20:22, -1, "center") %>% 
       set_number_format(2:19, -1, 4) %>% 
       set_tb_padding(2) %>% 
       set_width(0.9) %>% 
       set_font_size(10) %>%
       set_caption("Regressions of spouse PSEA on birth order and mediators")
```

Table \@ref(tab:tbl-bo-psea) shows the results. Column 1 shows the
effect of birth order, using the same specification as column 3 of the
previous table. The remaining columns add potential mediators of
birth order effects. Column 2 controls for our first measure of
socio-economic status: university attendance. We also include potential
non-SES mediators, which are affected by birth order and might affect spouse
matching: fluid IQ, height, BMI and self-reported health. Column 3 adds our 
second measure of socio-economic status, income in first job. Column 4 includes 
both.

When we add university attendance and other mediators (column 2), the effect of
birth order drops and becomes insignificant, while the coefficient for
university is positive and highly significant. Fluid IQ, height and BMI are also
positive and significant, while self-reported health has the right sign but is
insignificant. Controlling for income instead of university attendance (column
3), again the effect of birth order shrinks and becomes insignificant, while
income has a positive and highly significant effect. Lastly, the same pattern
holds when we control for both university and income (column 4).

```{r tbl-mediation-prop, cache = FALSE}

# percent of main effect that is mediated by uni:
# uni effect of BO (first stage) * PSEA effect of uni (column 2)
# divided by PSEA effect of BO (column 1)

mediators <- c("university.xTRUE", "first_job_pay.x", "height.x",
                 "fluid_iq.x", "bmi.x", "sr_health.x")

n_mediators <- length(mediators)

compute_mediation_effects <- function (resample = FALSE) {
  mf_pairs_tmp <- mf_pairs_reg
  if (resample) {
    mf_pairs_tmp <- mf_pairs_tmp[sample(nrow(mf_pairs_tmp), replace = TRUE),]
  }
  
  mod_bo_1st_boot <- purrr::map(fml_bo_1st, fixest::feols, 
                                  data = mf_pairs_tmp, notes = FALSE)
  mod_bo_psea_boot <- purrr::map(fml_bo_psea, fixest::feols, 
                                   data = mf_pairs_tmp, notes = FALSE)
  mod_bo_overall_boot <- fixest::feols(fml_bo_psea[[1]], 
                                         data = mf_pairs_tmp, 
                                         notes = FALSE
                                       )
                                  

  # grab out the birth_order.x coefficient:
  mediator_effect_bo <- purrr::map_dbl(mod_bo_1st_boot, 
                                         list(coef, "birth_order.x"))

  psea_effect_mediators <- purrr::map(mod_bo_psea_boot[-1],
                                         ~coef(.x)[mediators])
  psea_effect_mediators <- matrix(unlist(psea_effect_mediators), 
                                    ncol = n_mediators,
                                    byrow = TRUE)
  colnames(psea_effect_mediators) <- mediators
  
  psea_effect_bo <- coef(mod_bo_overall_boot)["birth_order.x"]

  effects_uni <- mediator_effect_bo["University"] * 
    psea_effect_mediators[, "university.xTRUE"] 
  effects_income <- mediator_effect_bo["Income"] * 
    psea_effect_mediators[, "first_job_pay.x"]
  effects_height <- mediator_effect_bo["Height"] * 
    psea_effect_mediators[, "height.x"] 
  effects_fluid_iq <- mediator_effect_bo["Fluid IQ"] * 
    psea_effect_mediators[, "fluid_iq.x"]
  effects_bmi <- mediator_effect_bo["BMI"] * 
    psea_effect_mediators[, "bmi.x"]
  effects_health <- mediator_effect_bo["Health"] * 
    psea_effect_mediators[, "sr_health.x"]
  
  effects_pct <- cbind(
          University = effects_uni, 
          Income     = effects_income, 
          Height     = effects_height, 
          `Fluid IQ` = effects_fluid_iq,
          BMI        = effects_bmi,
          `Self-reported health` = effects_health
        )
  # divide by overall effect re-estimated using data in each of models 2-4
  effects_pct <- effects_pct / psea_effect_bo
  
  effects_pct
}


# for each 1st stage model, run 199 bootstraps and gather coefs
n_reps <- 199

# bootstraps is now 3 x 4 x n_reps
# cis <- apply(bootstraps, 1:2, quantile, c(0.05, 0.95), na.rm = TRUE)
estimates <- compute_mediation_effects(resample = FALSE)

format_est_ci <- function(coef, model) {
  # char <- glue::glue("{percent(estimates[model, coef], 0.1)} ({percent(cis[1, model, coef], 0.1)}, {percent(cis[2,model, coef], 0.1)})")
  char <- estimates[model, coef] * 100
  char[is.na(estimates[model, coef])] <- ""
  char
}

med_matrix <- format_est_ci(c("University", "Income", "Fluid IQ", "Height", 
                                "BMI", "Self-reported health"), 
                              1:3)
med_matrix <- matrix(med_matrix, ncol = 3, byrow = TRUE)
rownames(med_matrix) <- c("University", "Income", "Fluid IQ", "Height", "BMI",
                            "Self-reported health")
colnames(med_matrix) <- paste("Model", 2:4, " (%)")

tbl_note <- paste("Percentage of the effects of birth order in Table", 
"\\ref{tab:tbl-bo-psea}, columns 2 to 4, explained by by each mediating variable.")

as_huxtable(med_matrix, add_colnames = TRUE, add_rownames = "") %>% 
      theme_article() %>% 
      add_footnote(tbl_note) %>% 
      set_escape_contents(final(1), everywhere, FALSE) %>% 
      set_width(0.7) %>% 
      set_col_width(c(.4, .2, .2, .2)) %>% 
      set_align(1, -1, "right") %>% 
      set_align(-1, -1 , ".") %>% 
      set_number_format(-1, -1, 1) %>% 
      set_tb_padding(3) %>% 
      set_bottom_border(1, 1, 0) %>% 
      set_caption(
        "Percent of birth order effects accounted for by mediators, models 2-4"
      )  

```


Under the assumptions discussed above, we can estimate the proportion of
the birth order effect that is mediated by these variables. Table
\@ref(tab:tbl-mediation-prop) reports this for each model in columns
2-4. Each estimate is the coefficient of birth order on the mediator,
times the coefficient of the mediator on spouse PSEA, divided by the
coefficient of birth order on spouse PSEA estimated from column 1, i.e.
without mediators. Education explains about 38-55 percent of the effect, much more
than all the other mediators. Income, fluid IQ, height and BMI all explain 
between 6 and 17 percent of the effect, depending on the specification.

These results provide evidence that birth order affects spouse PSEA via
education and income, with education being especially important.

Our next regressions split up the data into subsets. Cultural
stereotypes often assume that the link between status and genes is not
symmetric across the genders, for example, that males with high SES are
particularly likely to marry attractive spouses. Claim \@ref(claim-men-women-different) showed that these differences would strengthen
the effects of SGAM.
To test for this, we
separately regress female spouses' PSEA on male birth order, and male
spouses' PSEA on female birth order. We also rerun regressions among the
subset of individuals who had children. A significant result here will
confirm that the association between status and genetics is carried over
into the next generation.

Table \@ref(tab:tbl-bo-subsets) shows the results. Columns 1 and 2 present
results using birth order of male respondents to predict female spouses' PSEA.
Column 1 shows the regression of birth order plus controls; in column 2, we add
university attendance and non-SES mediators (here, we exclude first job income
so as to keep our N large). Columns 3 and 4 repeat the exercise for female
respondents, using their birth order to predict male spouses' PSEA. The effect of
birth order is imprecisely estimated in these subsets due to the lower sample
size. However, the pattern of coefficient sizes is the same as in the main
regression: the coefficient of birth order is about -0.3, and adding university
attendance reduces the absolute size of the birth order effect. Columns 5 and 6
show results from regressions on the subsample of couples with children. 
Here, birth order is significant in the base specification, and again, 
university attendance still seems to mediate the birth order effect.


```{r tbl-bo-subsets}

mod_bo_males <- lapply(fml_bo_psea[1:2], fixest::feols, 
                 data = mf_pairs_reg %>% filter(x == "Male"),
                 notes = FALSE
               )
mod_bo_females <- lapply(fml_bo_psea[1:2], fixest::feols, 
                 data = mf_pairs_reg %>% filter(x == "Female"),
                 notes = FALSE
               )

mf_pairs_children <- mf_pairs_reg %>% 
                   filter(n_children.x > 0, n_children.y > 0)
mod_bo_children <- lapply(fml_bo_psea[1:2], fixest::feols, 
                 data = mf_pairs_children,
                 notes = FALSE
               )
# 
# ta_m <-  list(conf.int = FALSE, cluster = 
#                 list(mf_pairs_reg$f.54.0.0.x[mf_pairs_reg$x =="Male"]))
# ta_f <-  list(conf.int = FALSE, cluster = 
#                 list(mf_pairs_reg$f.54.0.0.x[mf_pairs_reg$x == "Female"]))
# ta_ch <-  list(conf.int = FALSE, cluster = list(mf_pairs_children$f.54.0.0.x))

reg_list <- list(
        "Male respondents"     = mod_bo_males[[1]],
        "Male respondents"     = mod_bo_males[[2]],
        "Female respondents"   = mod_bo_females[[1]],
        "Female respondents"   = mod_bo_females[[2]],
        "With children"        = mod_bo_children[[1]],
        "With children"        = mod_bo_children[[2]]
      )

tbl_note <- paste("Estimates from OLS regressions corresponding to",
"columns 1 and 2 in Table \\ref{{tab:tbl-bo-psea}}, separately for males, females",
"and respondents with children. Spouse PSEA is the dependent variable, and own",
"birth order and university attendance are the main independent variables. PSEA",
"is the polygenic score for educational attainment, which is normalized with",
"mean 0 and standard deviation 1. We include own PSEA, parents‚Äô age at birth (the mean of",
"parent‚Äôs ages) and further controls (family size, birth year, and birth month",
"dummies) to ensure the balance of", 
"covariates across birth order. All data is from the UK Biobank for a sample of", 
"UK individuals born between 1935 and 1970.", my_note)

huxreg(reg_list,
         coefs      = reg_coefs[reg_coefs != "first_job_pay.x"],
         statistics = c("N" = "nobs", "R2" = "r.squared"),
         note       = tbl_note,
         stars      = my_stars,
         tidy_args  = tidy_args
       ) %>% 
       set_escape_contents(final(1), everywhere, FALSE) %>% 
       insert_row(after = 17, "Family size dummies", rep("Yes", 6)) %>% 
       insert_row(after = 18, "Birth month dummies", rep("Yes", 6)) %>% 
       insert_row(after = 19, "Birth year dummies", rep("Yes", 6)) %>% 
       set_bottom_border(18:19, everywhere, 0) %>% 
       set_align(18:20, -1, "center") %>% 
       set_font_size(10) %>% 
       set_width(1) %>% 
       set_tb_padding(3) %>% 
       set_lr_padding(3) %>% 
       set_caption("Regressions of spouse PSEA on birth order: subsets")

```

\FloatBarrier

## Robustness

Although all children of the same parents have the same polygenic scores
in expectation, it might still be possible that genetics correlates with
birth order within the sample. This could happen in three ways. First,
siblings with high birth order will typically come from larger families
than those with low birth order, and parents of different-sized families
are likely to differ systematically on many dimensions, including
genetics. We controlled for this by including a full set of family size
dummies in the regression. Second, there could be selection bias. For
example, if later siblings with high PSEA, and earlier siblings with low
PSEA, are more likely to enter the sample, then this would bias our
results. Thirdly, parents might choose family size in a way related to
genetics. For example, suppose that when the first child has a phenotype
reflecting a high PSEA, parents are more likely to have a second child.
Then within the subset of two-child families, first children would have
higher-than-average PSEA, while second children would not.

```{r calc-pgs-check}

check_cor <- function (score_name) {
  fml_check <- as.formula(paste0(score_name, ".x ~ factor(n_sibs.x) + birth_order.x"))
  mod_check <- lm(fml_check, mf_pairs_reg)
  mod_check %>% 
        tidy() %>% 
        filter(term == "birth_order.x") %>% 
        mutate(score = score_name)
}

check_cor_within <- function (score_name) {
  fml_check_within <- as.formula(paste0(score_name, 
                        ".x ~ 0 + factor(n_sibs.x) + factor(n_sibs.x):factor(birth_order.x)"))
  mod_check <- lm(fml_check_within, mf_pairs_reg)
  # NB: the model creates NA estimates for when n_sibs <= birth_order
  # since these have 0 rows in the data. I think this is not a problem.
  mod_check %>% 
        tidy() %>% 
        filter(grepl("birth_order", term)) %>% 
        filter(! is.na(estimate)) %>% 
        mutate(score = score_name)
}

drake::loadd(score_names)
score_names <- paste0(score_names, "_resid")
balance_check <- purrr::map_dfr(score_names, check_cor)
balance_check_within <- purrr::map_dfr(score_names, check_cor_within)

if (any(balance_check$p.value < 0.1/33)) stop("Some check p values < 0.1/33; rewrite text!")

n_below_10 <- sum(balance_check$p.value < 0.10)
stopifnot(n_below_10 == 4)
if(any(
        balance_check %>% filter(p.value < 0.10) %>% pull(estimate) > 0.02
      )) stop("Some coefs > 0.02; rewrite text!")

n_within_coefs <- nrow(balance_check_within)
if (any(balance_check_within$p.value < 0.001)) stop("Some within-siblings p values < 0.001; rewrite text!")


max_coef <- max(abs(balance_check$estimate))

mod_bo_own_psea <- lm(EA3.x ~ birth_order.x, 
                      mf_pairs_reg,
                      subset = n_sibs.x==3)
coef_own_psea_3 <- tidy(mod_bo_own_psea)[[2, "estimate"]]
pval_own_psea_3 <- tidy(mod_bo_own_psea)[[2, "p.value"]]
stopifnot(pval_own_psea_3 < 0.1)
stopifnot(pval_own_psea_3 > 0.05)

```

To check for the latter two problems, we run balance tests on 33 different
polygenic scores.[^10] We regress each score on own birth order, controlling for
family size. No scores were significant at $p < 0.10/33$. Four scores were
significant at $p < 0.10$, all with effect sizes of less than 0.02 per standard
deviation. Table \@ref(tab:tbl-bo-psea-pgs) in the appendix reports 
regressions controlling for these scores. Results are almost unchanged. To test
whether polygenic scores might vary across birth orders within a particular
family size, we also regress each score on a full set of birth order dummies,
interacted with a full set of family size dummies. None of the 
`r n_within_coefs` birth order coefficients were significant at $p < 0.001$.
However, among families of size 3, there is a marginally significant positive
correlation of birth order with own PSEA (effect size 
`r pretty(coef_own_psea_3, 3)`, $p = `r pretty(pval_own_psea_3, 2)`$). Table
\@ref(tab:tbl-bo-psea-no3) in the appendix therefore reports regressions with
families of size 3 excluded. Results are substantially unchanged. Of course,
there could still be unmeasured genetic variants which correlate with birth
order in our sample. Nevertheless, a wide set of polygenic scores shows no large
or significant correlation. This makes us more confident that birth order is
indeed exogenous to genetics.

[^10]: Polygenic scores were residualized on the first 100 principal
    components of the genetic data. Scores were for: ADHD, age at
    menarche, age at menopause, agreeableness, age at smoking
    initiation, alcohol use, Alzheimer's, autism, bipolarity, BMI, body
    fat, caffeine consumption, cannabis (ever vs. never), cognitive
    ability, conscientiousness, coronary artery disease, smoking
    (cigarettes per day), type II diabetes, drinks per week, educational
    attainment (EA2 and EA3), anorexia, extraversion, height, hip
    circumference, major depressive disorder, neuroticism, openness,
    smoking cessation, schizophrenia, smoking initiation, waist
    circumference, and waist-to-hip ratio. For full details of score
    construction, see @abdellaoui2019genetic.


```{r calc-oster-2019}
# Plan:
# 1. pick the max R2 of spousal PSEA, backing it out

# 2. for each SES mediator (university, first_job_pay):
#   run the "short regression" including only BO, the SES mediator and controls
#   run the "medium regression" including these + non-SES mediators
#   using these statistics and the max R2, calculate the delta 
#   (degree of selection into treatment on unobservables, compared to 
#   selection on observables)
#   that would lead the effect of the SES mediator to be zero

# we need the max R2 of spousal PSEA *from an unobserved environmental factor*, 
# given that we know birth order's effect could only be via the environment.
# So, sources of error are (1) limits to assortative mating
# (2) error in measured PSEA (3) only environmental factors can contribute
# to the R2
# 

mod_ea_psea <- fixest::feols(age_fulltime_edu ~ EA3_excl_23andMe_UK, 
                               data = famhist, notes = FALSE)
R2_ea_psea <- fixest::r2(mod_ea_psea, type = "r2")
prop_systematic_psea <- R2_ea_psea/0.4 

true_psea_R2_max <- 0.5
R2max <- prop_systematic_psea * true_psea_R2_max

res_uni <- robomit::o_delta(y = "EA3.y", x = "university.x", 
                            con = "fluid_iq.x + height.x + 
                                   bmi.x + sr_health.x", 
                            m = "EA3.x + par_age_birth.x + factor(n_sibs.x) +
                                 factor(YOB.x) + factor(birth_mon.x)", 
                            R2max = R2max, type = "lm", data = mf_pairs_reg)
res_fjp <- robomit::o_delta(y = "EA3.y", x = "first_job_pay.x", 
                            con = "fluid_iq.x + height.x + bmi.x +
                                   sr_health.x", 
                            m = "EA3.x + par_age_birth.x + factor(n_sibs.x) +
                                 factor(YOB.x) + factor(birth_mon.x)", 
                            R2max = R2max, type = "lm", data = mf_pairs_reg)

delta_uni <- round(res_uni[[1, 2]], 3)
delta_fjp <- round(res_fjp[[1, 2]], 3)

```


Another concern is that our chosen SES mediators might not be exogenous. We have
already seen that birth order affects intelligence, height, BMI
and health. So there might be other unobserved variables which mediate the effect
of birth order on spousal PSEA, and which correlate with education or income,
but which do not themselves capture SES. If so, that would threaten our claim
that education and income are important mediators. However, the effects of
education on spouse PSEA in Table \@ref(tab:tbl-bo-psea), and of birth order on
education in Table \@ref(tab:tbl-bo-first-stage), are both large and highly
significant. In other literature on spouse matching, education is a common,
robust and significant predictor. For these reasons, we think that our results
are unlikely to be driven wholly by other, unobserved mediators.

A last concern is that polygenic scores, including PSEA, contain noise from
correlated environments. (That is, effect sizes of individual SNPs may be
confounded in the underlying statistical analyses used to create polygenic
scores.) It is conceivable that birth order could only affect the noise
component of spouse PSEA, rather than the component which is truly causal for
education. We think this is unlikely, because it is hard to imagine an
assortative mating process by which high-SES people would match spouses with
only genetic variants that correlate with, but do not cause, higher educational
attainment.

Our main specification is linear in birth order. Tables
\@ref(tab:tbl-bo-psea-dummies) and \@ref(tab:tbl-bo-subset-dummies) in the
appendix run specifications with separate dummies for each birth order. The
pattern that birth order coefficients shrink after controlling for SES mediators
holds robustly across all birth orders and sample subsets.

UK Biobank is not a representative sample of the UK population. Table
\@ref(tab:tbl-bo-psea-weights) in the appendix weights cases to match the
Biobank's sampling frame. Results are similar to those in the main text. 
Although this is still not representative of the population as a whole, it 
provides some assurance that our results are not driven by volunteering bias.

The appendix reports other robustness checks, including replacing university
attendance with age of leaving full-time education. 


# Conclusion

Our empirical analysis shows that in a contemporary developed society,
individuals with fewer elder siblings had spouses with higher PSEA. We also provide
evidence that these effects are mediated by socio-economic status, specifically
income and education. We interpret this as evidence of social-genetic assortative
mating (SGAM). 

There are multiple mechanisms by which advantage is transmitted across
generations. High-income parents may invest more in their children's human
capital, transfer wealth via gifts and bequests, model valuable skills, or
provide them with advantageous social networks. They may also pass on causally
relevant genetic variants. This channel has been proposed as a reason for the
surprising persistence of inequality over generations
[@clark2015intergenerational; @clark2021bell]. One problem with this theory is
that in the absence of assortative mating, genetic variation regresses swiftly
to the mean, with coefficient $r = 0.5$ per generation. Thus to explain long-run
persistence, the genetic theory seems to require very high levels of genetic
assortative mating. SGAM may help to solve this puzzle. Persistence will be
increased if, in addition to genetic assortative mating, high SES itself
attracts "good genes". At the same time, SGAM changes the interpretation of 
genetics. As our model shows, genetic variation is not an exogenous input into 
the social system, but an endogenous outcome -- not a confound for wealth, but a mediator. 

SGAM also provides a new explanation for the genes-SES gradient -- the observed
association of genes with SES. The leading alternative explanation is
meritocratic social mobility. Whilst meritocracy exists in modern capitalist
economies, it has been far more limited in most societies throughout history
[@smelser1966social]. On the other hand, assortative mating is likely to be a
cultural universal [@buss1989sex]. Thus, SGAM predicts that genes-SES gradients
should exist in all stratified societies. In fact, people in many societies have
believed that innate traits do vary by social status.[^quotes] In future, it may be
possible to directly test for genetic differences across social status in
ancient DNA samples.

[^quotes]: The appendix contains a selection of relevant historical quotations.

In our model, the association between SES and genetic variation depends on
economic and social institutions. Institutions that make wealth more persistent
across generations also increase the correlation between SES and genetics. If
so, then institutional differences may have long-run effects over generations by
altering the genes-SES gradient. There could be hysteresis, with initial social
differences cumulating over time via their effect on genetic inequality. On the
other hand, while lowering the intergenerational transmission of wealth may
eventually flatten the genes-SES gradient, increases in the level of meritocracy
paradoxically make it steeper, suggesting a deep conflict between meritocracy
and egalitarianism [@young1958rise; @markovits2019meritocracy]. Lastly, the
structure of marriage markets also affects the gradient. Testing these comparative 
statics across societies and time periods is an important challenge for future work.

The broadest message of this paper is that genetics are a social
outcome. Both popular and scientific discourse often parse genetics as
"nature", in opposition to "nurture" or "environment" [e.g.
@chakravarti2003nature; @plomin2019blueprint]. This reflects the fact that
our individual genetic endowment is fixed at birth, affects our body and brain
through proximate biological mechanisms, and cannot be changed by our social
environment (though genes always interact with the environment to cause
individual outcomes). But the idea that human genetics are natural can be highly
misleading. Humans inherit their genes from their parents, along with other
forms of inheritance such as economic and cultural capital. Human parents, in
turn, form spouse pairs and bear children within social institutions. A person's
genetic inheritance is a social and historical fact about them, not just a
fact of nature. As @marx1844economic wrote, "History is the true natural history of
man". Genetic endowments can even be viewed as another form of capital,
alongside human, social and cultural capital: a resource to be sought,
accumulated and competed over. The analysis of this kind of capital is an
exciting area for further research, which will require the contributions of both
economists and geneticists.


# Acknowledgements

AA is supported by the Foundation Volksbond Rotterdam and by ZonMw grant 
849200011 from The Netherlands Organisation for Health Research and Development. 
This study was conducted using UK Biobank resources under application number 
40310.

Code to reproduce is available at https://github.com/hughjonesd/trading-genetics.


\FloatBarrier

\newpage

# Appendix

## For online publication

\localtableofcontents
\clearpage

## Proofs

```{r proofs, child = "proofs.Rmd"}

```

\FloatBarrier

\newpage

## Robustness checks

Table \@ref(tab:tbl-bo-psea-no-par-age) reruns our central regressions,
dropping the control for parents' age at birth. Results show the same
pattern as in the main text: the coefficient for birth order is
negative, but changes sign when university attendance is added as a
potential mediator. However, the birth order effect is smaller overall,
and is never significant. We also ran regressions using father's age
only: results are similar to those in the main text.

Table \@ref(tab:tbl-bo-psea-dummies) reruns our central regressions but
includes a separate coefficient for each position in the birth order
(with firstborn as the baseline). The basic pattern of our main result
holds: birth order coefficients are generally negative; adding mediators
causes them to increase towards zero or to change sign. Birth order
effects appear largest for birth order 2-3. However, effects for later
birth orders are also imprecisely estimated (since fewer respondents
come from large families).

Notably when we add income, dummies for birth order 5 and 6 become large
and positive. This could be (for instance) because being the last born
has advantages after effects on SES have been netted out. Table
\@ref(tab:tbl-bo-subset-dummies) runs the same exercise for different
subsets: male respondents, female respondents, and couples with
children. The basic pattern that birth order coefficients shrink after
adding mediators is quite robust. Note however that here, the estimates
of effects for birth order 2-3 are larger for females.

We also ran a specification with separate birth order dummies within
each family size. Figure \@ref(fig:pic-bo-psea-interactions) shows 95%
confidence intervals for the birth order coefficients, from the column 2
specification including height and IQ controls but no mediators. Not
surprisingly, coefficients are imprecisely estimated. But most birth
order coefficients are negative compared to the baseline for firstborns.

Table \@ref(tab:tbl-bo-psea-weights) re-estimates Table \@ref(tab:tbl-bo-psea)
using weights from @vanalten2022reweighting. These weight the UK Biobank sample
to match its sampling frame of 40-69 year olds living close to 22 assessment
centres. Although these weights probably bring the sample closer to the UK population, the sampling frame is still not representative of that population: 
for instance, urban areas are oversampled. Results are similar to those in
the main text, although birth order coefficients are absolutely larger in all
the specifications. 

Table \@ref(tab:tbl-bo-psea-pgs) reruns our regressions controlling for
several polygenic scores. Results are very close to those in the main
text.

Table \@ref(tab:tbl-bo-psea-age-fte) reruns relevant columns of Table
\@ref(tab:tbl-bo-psea) using age of leaving full-time education as a
measure of educational SES, instead of the university attendance dummy.
Results are similar to those in the main text: controlling for age of
leaving full-time education shrinks the effect of birth order and makes
it insignificant.

Table \@ref(tab:tbl-bo-psea-no3) reruns Table \@ref(tab:tbl-bo-psea)
excluding families of size 3. Results are very similar to those in the
main text.


```{r tbl-bo-psea-no-par-age}


age_table <- famhist %>% 
      filter(n_sibs >=2, n_sibs <= 6, ! is.na(birth_order)) %>% 
      group_by(n_sibs, birth_order) %>% 
      dplyr::summarize(
        N   = n(), 
        mfa = mean(fath_age_birth, na.rm = TRUE),
        mma = mean(moth_age_birth, na.rm = TRUE),
        .groups = "drop"
      )

fml_bo_no_par_age <- lapply(fml_bo_psea, update, 
                     . ~ . - par_age_birth.x, 
                     rhs = 1
                   )
mod_bo_no_par_age <- lapply(fml_bo_no_par_age, fixest::feols,
                     data  = mf_pairs_reg, 
                     notes = FALSE
                   )

fml_bo_fath_age <- lapply(fml_bo_no_par_age, update, 
                     . ~ . + fath_age_birth.x, 
                     rhs = 1
                   )
mod_bo_fath_age <- lapply(fml_bo_fath_age, fixest::feols,
                     data  = mf_pairs_reg, 
                     notes = FALSE
                   )

huxreg(mod_bo_no_par_age, 
         coefs     = reg_coefs[reg_coefs != "par_age_birth.x"],
         note      = my_note,
         stars     = my_stars,
         tidy_args = tidy_args
       ) %>% 
       insert_row(after = 17, "Family size dummies", rep("Yes", 4)) %>% 
       insert_row(after = 18, "Birth month dummies", rep("Yes", 4)) %>% 
       insert_row(after = 19, "Birth year dummies", rep("Yes", 4)) %>% 
       set_bottom_border(18:19, everywhere, 0) %>% 
       set_align(18:20, -1, "center") %>% 
       set_number_format(2:17, -1, 4) %>% 
       set_font_size(11) %>%
       set_caption("Regressions of spouse PSEA, without controls for parents' age at respondent's birth")

```


```{r tbl-bo-psea-dummies}

# we use standard lms because fixest::wald breaks sometimes

fml_bo_psea_dummies <- purrr::map(fml_bo_psea, formula, collapse = TRUE)

fml_bo_psea_dummies <- purrr::map(fml_bo_psea_dummies, update, 
                                    . ~ . - birth_order.x + 
                                    factor(birth_order.x))

# use a formula here to preserve the `data` argument
mod_bo_psea_dummies <- purrr::map(fml_bo_psea_dummies, ~lm(.x, 
                         data = mf_pairs_reg))

mod_restricted <- purrr::map(mod_bo_psea_dummies, 
                               ~update(.x, . ~ . - factor(birth_order.x)))

my_vcov <- function (x) sandwich::vcovHC(x, type ="HC1")
wald_tests <- purrr::map2(mod_bo_psea_dummies, mod_restricted,
                          lmtest::waldtest, vcov = my_vcov)
wald_pvals <- purrr::map_dbl(wald_tests, ~ pull(tidy(.x), p.value)[2])


dummy_reg_coefs <- grep("factor\\(birth_order", 
                         names(coef(mod_bo_psea_dummies[[1]])),
                         value = TRUE)
names(dummy_reg_coefs) <- gsub("^.*(\\d).*$", "Birth order \\1",
                                 dummy_reg_coefs)
dummy_reg_coefs <- c(
                      dummy_reg_coefs,
                      "University"  = "university.xTRUE", 
                      "Income"      = "first_job_pay.x",
                      "Own PSEA"     = "EA3.x",
                      "Parents' age at birth" = "par_age_birth.x"
                    )

ht <- huxtable::huxreg(mod_bo_psea_dummies, 
                   coefs     = dummy_reg_coefs,
                   note      = paste(my_note, 
                     "\nGrey background: coefficients are higher than column 1."),
                   stars     = my_stars,
                   tidy_args = tidy_args
                 ) %>% 
       insert_row(after = 19, "Wald p-value, birth order", wald_pvals) %>%
       insert_row(after = 20, "Family size dummies", rep("Yes", 4)) %>% 
       insert_row(after = 21, "Birth month dummies", rep("Yes", 4)) %>% 
       insert_row(after = 22, "Birth year dummies", rep("Yes", 4)) %>% 
       insert_row(after = 23, "Other mediators (IQ, height, BMI, s.-r. health)", 
                    c("No", rep("Yes", 3))) %>% 
       set_bottom_border(21:23, everywhere, 0) %>% 
       set_align(21:24, -1, "center") %>% 
       set_number_format(2:20, -1, 4) %>% 
       set_caption("Regressions of spouse PSEA, separate birth order dummies") %>% 
       set_tb_padding(2) %>% 
       set_font_size(10) %>% 
       set_width(0.9)

coef_vals <- as.matrix(ht[seq(2, 10, 2), 2:5])
coef_vals <-  readr::parse_number(coef_vals)
dim(coef_vals) <- c(5, 4)
coefs_larger <- coef_vals[1:5, -1] > coef_vals[1:5, 1]
background_color(ht)[seq(2, 10, 2), 3:5] <- ifelse(coefs_larger, "grey90", 
                                                     "white")
ht

```


```{r tbl-bo-subset-dummies}

fml_bo_psea_dummies <- fml_bo_psea %>% 
                         purrr::map(update_with_birth_order_dummies)

mod_bo_males_dummies <- lapply(fml_bo_psea_dummies[1:2], 
                                 fixest::feols, 
                                 data = mf_pairs_reg %>% 
                                   filter(x == "Male"),
                                 notes = FALSE
                        )
mod_bo_females_dummies <- lapply(fml_bo_psea_dummies[1:2], 
                                  fixest::feols, 
                                  data = mf_pairs_reg %>% 
                                    filter(x == "Female"),
                                  notes = FALSE
                          )

mf_pairs_children <- mf_pairs_reg %>% 
                       filter(n_children.x > 0, n_children.y > 0)
mod_bo_children_dummies <- lapply(fml_bo_psea_dummies[1:2], 
                             fixest::feols, 
                             data = mf_pairs_children,
                             notes = FALSE
                           )
reg_list <- list(
        "Males"                = mod_bo_males_dummies[[1]],
        "Males"                = mod_bo_males_dummies[[2]],
        "Females"              = mod_bo_females_dummies[[1]],
        "Females"              = mod_bo_females_dummies[[2]],
        "With children"        = mod_bo_children_dummies[[1]],
        "With children"        = mod_bo_children_dummies[[2]]
      )

wald_tests <- purrr::map(reg_list, fixest::wald, 
                           keep    = "birth_order",
                           se      = tidy_args$se,
                           print   = FALSE
                         )
wald_pvals <- purrr::map_dbl(wald_tests, "p")

dummy_reg_coefs <- grep("factor\\(birth_order", 
                          names(coef(mod_bo_males_dummies[[1]])),
                          value = TRUE)
names(dummy_reg_coefs) <- gsub(".*(\\d).*$", "Birth order \\1",
                                 dummy_reg_coefs)

dummy_reg_coefs <- c(
                      dummy_reg_coefs,
                      "University"  = "university.xTRUE", 
                      "Own PSEA"     = "EA3.x",
                      "Parents' age at birth" = "par_age_birth.x"
                     )

ht <- huxtable::huxreg(reg_list, 
                   coefs = dummy_reg_coefs,
                   note = paste(my_note, "\nGrey background: birth dummy",
                                "coefficient is higher than corresponding",
                                "coefficient without mediators."),
                   stars = my_stars,
                   tidy_args = tidy_args
                 ) %>% 
       insert_row(after = 17, c("Wald p-value, birth order", wald_pvals)) %>% 
       insert_row(after = 18, "Family size dummies", rep("Yes", 6))   %>% 
       insert_row(after = 19, "Birth month dummies", rep("Yes", 6))   %>% 
       insert_row(after = 20, "Birth year dummies", rep("Yes", 6))    %>% 
       insert_row(after = 21, "Other mediators (IQ, height, BMI, s.-r. health)", 
                    rep(c("No", "Yes"), 3)) %>% 
       set_bottom_border(19:21, everywhere, 0) %>%
       set_align(19:22, -1, "center") %>% 
       set_number_format(2:18, -1, 4) %>% 
       set_caption("Regressions of spouse PSEA, separate birth order dummies: subsets") %>% 
       set_tb_padding(3) %>% 
       set_lr_padding(2) %>% 
       set_font_size(9) %>% 
       set_width(0.95)


coef_vals <- as.matrix(ht[seq(2, 10, 2), 2:7])
coef_vals <-  readr::parse_number(coef_vals)
dim(coef_vals) <- c(5, 6)
coefs_larger <- cbind(
                        coef_vals[, 2] > coef_vals[, 1], 
                        coef_vals[, 4] > coef_vals[, 3], 
                        coef_vals[, 6] > coef_vals[, 5]
                      )
background_color(ht)[seq(2, 10, 2), seq(3, 7, 2)] <- ifelse(coefs_larger, 
                                                              "grey90", "white")
ht

```


```{r calc-bo-mediator-interactions}

fml_bo_mediator_interact <- update(fml_bo_psea_dummies[[4]],
                                     . ~ . * factor(birth_order.x)) 
mod_bo_mediator_interact <- fixest::feols(fml_bo_mediator_interact, 
                                            data = mf_pairs_reg, 
                                            note = FALSE)

tidy_bo_mediator <- do.call(broom::tidy, c(list(x = mod_bo_mediator_interact), 
                                           tidy_args))

tidy_bo_mediator$sig <- tidy_bo_mediator$p.value < 0.05
n_interactions <- sum(grepl(":", tidy_bo_mediator$term))
tidy_bo_mediator$sig_corrected <- tidy_bo_mediator$p.value < 0.05/n_interactions
```


```{r pic-bo-psea-interactions, fig.align = "center", fig.cap = "Regressions of spouse PSEA: birth order dummies within different family sizes. Labels show birth order. Lines are 95 per cent confidence intervals. The omitted category is birth order 1."}
 
mf_pairs_reg$BO2 <- 1 * (mf_pairs_reg$birth_order.x == 2)
mf_pairs_reg$BO3 <- 1 * (mf_pairs_reg$birth_order.x == 3)
mf_pairs_reg$BO4 <- 1 * (mf_pairs_reg$birth_order.x == 4)
mf_pairs_reg$BO5 <- 1 * (mf_pairs_reg$birth_order.x == 5)
mf_pairs_reg$BO6 <- 1 * (mf_pairs_reg$birth_order.x == 6)
mf_pairs_reg$nsf <- factor(mf_pairs_reg$n_sibs.x)

fml_bo_psea_full <- update(fml_bo_psea[[1]], . ~ . - birth_order.x + 
                             nsf:(BO2 + BO3 + BO4 + BO5 + BO6))

mod_bo_psea_full <- fixest::feols(fml_bo_psea_full, mf_pairs_reg, 
                                    notes = FALSE)
coefs <- tidy(mod_bo_psea_full, conf.int = TRUE, se = "hetero")

suppressWarnings({
  coefs[["Family size"]] <- as.numeric(gsub("^nsf(.).*", "\\1", coefs$term))
  coefs[["Birth order"]] <- as.numeric(gsub(".*BO(.)$", "\\1", coefs$term))
})

coefs %<>% filter(`Birth order` %in% 1:8)

ns_by_n_sibs <- as.data.frame(table(mf_pairs_reg$n_sibs.x))
ns_by_n_sibs$Var1 <- as.integer(as.character(ns_by_n_sibs$Var1))

suppressWarnings({
  gg <- ggplot(coefs, aes(estimate, `Family size`, colour = `Birth order`)) + 
          scale_color_continuous(type = "viridis", name = "Birth order") + 
          geom_vline(xintercept = 0, linetype = 2) +
          geom_pointrange(aes(xmin = conf.low, xmax = conf.high), 
                         alpha = 0.7, size = 1.15, fatten = 1,
                         position = position_dodge2(width = 0.15)) + 
          geom_text(aes(label = `Birth order`), nudge_y = 0.2, size = 5) + 
          guides(colour = "none") +
          xlab("Estimate")
  print(gg) # captures the warnings inside the suppressWarnings() call
})

```


```{r tbl-bo-psea-weights}

mod_bo_psea_weights <- purrr::map(fml_bo_psea, fixest::feols, 
                                    data = mf_pairs_reg,
                                    weights = mf_pairs_reg$weights.x, 
                                    notes = FALSE
                                  )


huxreg(mod_bo_psea_weights, 
         coefs     = reg_coefs,
         note      = my_note,
         stars     = my_stars,
         tidy_args = tidy_args
       ) %>% 
       insert_row(after = 17, "Family size dummies", rep("Yes", 4)) %>% 
       insert_row(after = 18, "Birth month dummies", rep("Yes", 4)) %>% 
       insert_row(after = 19, "Birth year dummies", rep("Yes", 4)) %>% 
       set_bottom_border(18:19, everywhere, 0) %>% 
       set_align(18:20, -1, "center") %>% 
       set_number_format(2:17, -1, 4) %>% 
       set_caption("Regressions of spouse PSEA, weighted to match UK Biobank sampling frame")

```


```{r tbl-bo-psea-pgs}

fml_bo_psea_pgs <- fml_bo_psea %>% 
                        purrr::map(update, 
                           . ~ . + 
                           alzheimer_resid.x + 
                           cognitive_ability_resid.x +
                           neuroticism_resid.x +
                           sc_substance_use_resid.x
                        )

mod_bo_psea_pgs <-  purrr::map(fml_bo_psea_pgs, fixest::feols, 
                         data = mf_pairs_reg,
                         notes = FALSE
                       )

huxreg(mod_bo_psea_pgs, 
         coefs = reg_coefs,
         statistics = c(
           "N" = "nobs", 
           "R2" = "r.squared"
         ),
         note = paste(my_note,
                 "\nPolygenic scores: alzheimer's, cognitive ability, neuroticism, substance use."),
         stars = my_stars,
         tidy_args = list(
           conf.int = FALSE, 
           cluster = list(mf_pairs_reg$f.54.0.0.x)
         )
       ) %>% 
       insert_row(after = 19, "Family size dummies", rep("Yes", 4)) %>% 
       insert_row(after = 20, "Birth month dummies", rep("Yes", 4)) %>% 
       insert_row(after = 21, "Birth year dummies", rep("Yes", 4)) %>% 
       insert_row(after = 22, "Polygenic score controls", rep("Yes", 4)) %>% 
       set_bottom_border(20:22, everywhere, 0) %>% 
       set_align(20:23, -1, "center") %>% 
       set_number_format(2:19, -1, 4) %>% 
       set_width(1) %>% 
       set_wrap(final(1), everywhere, TRUE) %>% 
       set_font_size(11) %>%
       set_caption("Regressions of spouse PSEA with controls for polygenic scores")
```


```{r tbl-bo-psea-age-fte}

fml_bo_psea_age_fte <- fml_bo_psea[c(1, 2, 4)]
fml_bo_psea_age_fte[2:3] <- lapply(fml_bo_psea_age_fte[2:3], 
                                update, 
                                . ~ . - university.x + age_fulltime_edu.x)

mod_bo_psea_age_fte <- lapply(fml_bo_psea_age_fte, fixest::feols, 
                 data = mf_pairs_reg,
                 notes = FALSE
               )


age_reg_coefs <- reg_coefs
age_reg_coefs[age_reg_coefs == "university.xTRUE"] <- "age_fulltime_edu.x"
names(age_reg_coefs)[age_reg_coefs == "age_fulltime_edu.x"] <- 
      "Age left full-time educ."

huxreg(mod_bo_psea_age_fte, 
         coefs     = age_reg_coefs,
         note      = my_note,
         stars     = my_stars,
         tidy_args = tidy_args
       ) %>% 
       insert_row(after = 19, "Family size dummies", rep("Yes", 3)) %>% 
       insert_row(after = 20, "Birth month dummies", rep("Yes", 3)) %>% 
       insert_row(after = 21, "Birth year dummies", rep("Yes", 3)) %>% 
       set_bottom_border(20:21, everywhere, 0) %>% 
       set_align(20:22, -1, "center") %>% 
       set_number_format(2:19, -1, 4) %>% 
       set_width(0.9) %>% 
       set_font_size(11) %>%
       set_caption("Regressions of spouse PSEA using age of leaving full-time education")
```


```{r tbl-bo-psea-no3}

mod_bo_psea_no3 <- lapply(fml_bo_psea, 
                            fixest::feols, 
                            data = mf_pairs_reg %>% 
                                     filter(n_sibs.x != 3),
                            notes = FALSE
                          )
huxreg(mod_bo_psea_no3, 
         coefs     = reg_coefs,
         note      = my_note,
         stars     = my_stars,
         tidy_args = tidy_args
       ) %>% 
       insert_row(after = 19, "Family size dummies", rep("Yes", 4)) %>% 
       insert_row(after = 20, "Birth month dummies", rep("Yes", 4)) %>% 
       insert_row(after = 21, "Birth year dummies", rep("Yes", 4)) %>% 
       set_bottom_border(20:21, everywhere, 0) %>% 
       set_align(20:22, -1, "center") %>% 
       set_number_format(2:19, -1, 4) %>% 
       set_caption("Regressions of spouse PSEA, excluding family size 3")
```


\FloatBarrier
\newpage

### Regressions with "fake pairs"

Our dataset of pairs could still contain pairs who live in the same
postcode but are not spouses. These pairs might still show a
relationship between one partner's phenotype and the other's genotype.
For example, maybe early-born children grow up to live in richer
postcodes, along with people who have higher PSEA scores
[@abdellaoui2019genetic]. This could then bias the results. If the
coefficient for "fake pairs" is absolutely larger (smaller) than for
real pairs, then our results will be biased away from zero (towards
zero).

To sign the bias, we create a dataset of "known fake pairs". These are
opposite-sexed pairs who live in the same postcode, but do not share all
the characteristics listed for the real pairs. Specifically, from the
list of characteristics used to create our real pairs (same
homeownership status, same length of time at address, same number of
children, attended same assessment center, attended on same day, husband
reported living with spouse, wife reported living with spouse) the fake
pairs ticked exactly 5 out of 7 boxes.

```{r calc-fake-pairs}

drake::loadd(mf_pairs_fake)
prop_shared_fake <- calc_prop_shared_children(mf_pairs_fake)

n_one <- prop_shared_fake$one
n_both <- prop_shared_fake$both
```

We again use genetic children to confirm that the fake pairs are "real
fakes". Out of `r n_one` genetic children of the fake pairs, only
`r n_both` were children of both parents. Thus, the vast majority of
fake pairs do not appear to be spouses. Table
\@ref(tab:tbl-bo-psea-fake) reruns the regressions of Table
\@ref(tab:tbl-bo-psea-basic) using the fake pairs. Although the
coefficients on birth order are always negative, and significant
when controlling for parent's age, they are always absolutely smaller than the
corresponding coefficient in the main text. This suggests that
any fake pairs remaining in our data will have the effect of biasing our
results towards zero.

```{r tbl-bo-psea-fake}

drake::loadd(mf_fake_twice)
fake_pairs_reg <- regression_subset(mf_fake_twice)
mod_bo_psea_fake <- lapply(fml_bo_psea_base, fixest::feols, 
                 data = fake_pairs_reg,
                 notes = FALSE
               )

huxreg(mod_bo_psea_fake, 
         coefs = c(
           "Birth order"           = "birth_order.x", 
           "Own PSEA"              = "EA3.x",
           "Parents' age at birth" = "par_age_birth.x"
         ),
         statistics = c(
           "N"  = "nobs", 
           "R2" = "r.squared"
          ),
         note = my_note,
         stars = my_stars,
         tidy_args = tidy_args
       ) %>% 
       insert_row(after = 7, "Family size dummies", rep("Yes", 3)) %>% 
       insert_row(after = 8, "Birth month dummies", "No", "Yes", "Yes") %>% 
       insert_row(after = 9, "Birth year dummies", "No", "Yes", "Yes") %>% 
       set_bottom_border(8:9, everywhere, 0) %>% 
       set_align(8:10, -1, "center") %>% 
       set_number_format(2:7, -1, 4) %>% 
       set_width(0.8) %>% 
       set_caption("Regressions of PSEA on birth order: fake pairs")

```


\FloatBarrier

\clearpage

## Quotations on natural inequality

...your face and figure have nothing of the slave about them, and
proclaim you of noble birth.

-- *Odyssey*, Odysseus to Laertes

Citizens, we shall say to them in our tale, you are brothers, yet God
has framed you differently. Some of you have the power of command, and
in the composition of these he has mingled gold, wherefore also they
have the greatest honour; others he has made of silver, to be
auxiliaries; others again who are to be husbandmen and craftsmen he has
composed of brass and iron; and the species will generally be preserved
in the children. But as all are of the same original stock, a golden
parent will sometimes have a silver son, or a silver parent a golden
son.

-- Plato *Republic*

Nature would like to distinguish between the bodies of freemen and
slaves, making the one strong for servile labor, the other upright, and
although useless for such services, useful for political life in the
arts both of war and peace. But the opposite often happens -- that some
have the souls and others have the bodies of freemen.

-- Aristotle *Politics*

Sons have no richer endowment than the quality

A noble and brave father gives in their begetting.

-- Euripides *Heracleidae*


His head by nature fram'd to wear a crown,

His hands to wield a sceptre....

-- Shakespeare *Henry VI Part 3*

A daughter of a green Grocer, walks the Streets in London dayly with a
baskett of Cabbage Sprouts, Dandelions and Spinage on her head. She is
observed by the Painters to have a beautiful Face, an elegant figure, a
graceful Step and a debonair. They hire her to Sitt. She complies, and
is painted by forty Artists, in a Circle around her. The Scientific Sir
William Hamilton outbids the Painters, Sends her to Schools for a
genteel Education and Marries her. This Lady not only causes the
Tryumphs of the Nile of Copenhagen and Trafalgar, but Seperates Naples
from France and finally banishes the King and Queen from Sicilly. Such
is the Aristocracy of the natural Talent of Beauty.

-- John Adams to Thomas Jefferson, on Emma Hamilton

\newpage

# References
